<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Two Little Bees Auto Parts | VIN-Verified OEM Used Parts | Indianapolis</title>

<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#0b0f14">
<meta name="description" content="Two Little Bees Auto Parts in Indianapolis ‚Äî VIN-verified OEM used parts. Engines, transmissions, modules, body parts, wheels, and more. Fast counter support.">
<meta name="robots" content="index,follow">
<link rel="canonical" href="https://twolittlebeesautoparts.github.io/OFFICIALPAGE/">

<!-- Open Graph / Social Preview -->
<meta property="og:type" content="website">
<meta property="og:title" content="Two Little Bees Auto Parts ‚Äî VIN-Verified OEM Used Parts">
<meta property="og:description" content="Indianapolis OEM used parts. Engines, transmissions, modules, body parts, wheels & more. Request a part, decode VIN, or get directions.">
<meta property="og:url" content="https://twolittlebeesautoparts.github.io/OFFICIALPAGE/">
<meta property="og:image" content="https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/new.logo.png?raw=true">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Two Little Bees Auto Parts ‚Äî VIN-Verified OEM Used Parts">
<meta name="twitter:description" content="Indianapolis OEM used parts. Request a part, decode VIN, or call now.">
<meta name="twitter:image" content="https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/new.logo.png?raw=true">

<link rel="preconnect" href="https://vpic.nhtsa.dot.gov">
<link rel="preconnect" href="https://www.gstatic.com">
<link rel="preconnect" href="https://identitytoolkit.googleapis.com">
<link rel="preconnect" href="https://github.com">
<link rel="preload" as="image" href="https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/new.logo.png?raw=true">

<style>
:root{
  --bg:#0b0f14;
  --panel:#111827;
  --panel2:#0f172a;
  --card:#0e1726;

  --text:#f9fafb;
  --muted:#9ca3af;

  --accent:#f4c430;
  --accent2:#ffb703;

  --border:rgba(255,255,255,.10);
  --border2:rgba(255,255,255,.14);

  --ok:#22c55e;
  --bad:#ef4444;
  --warn:#f59e0b;

  --shadow:0 30px 70px rgba(0,0,0,.55);
  --shadowSoft: 0 18px 50px rgba(0,0,0,.38);
  --radius:18px;

  --ring: 0 0 0 3px rgba(244,196,48,.18);
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;max-width:100%;overflow-x:hidden}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  color:var(--text);
  background:
    radial-gradient(900px 520px at 12% -10%, rgba(244,196,48,.16), transparent 60%),
    radial-gradient(900px 520px at 92% 14%, rgba(255,183,3,.12), transparent 60%),
    radial-gradient(700px 420px at 40% 120%, rgba(244,196,48,.08), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,.03), transparent 22%),
    var(--bg);
  padding-left:env(safe-area-inset-left);
  padding-right:env(safe-area-inset-right);
  padding-top:env(safe-area-inset-top);
  padding-bottom:calc(env(safe-area-inset-bottom) + 78px);
  -webkit-font-smoothing:antialiased;
}

a, button { -webkit-tap-highlight-color: transparent; }
button { font-family: inherit; }
:focus-visible{
  outline:none;
  box-shadow: var(--ring);
  border-radius:14px;
}

/* ============ Header ============ */
header{
  position:sticky; top:0; z-index:100;
  background:rgba(11,15,20,.78);
  backdrop-filter: blur(14px);
  border-bottom:1px solid rgba(255,255,255,.08);
}
.header-inner{
  max-width:1200px; margin:0 auto;
  padding:10px 16px;
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
}

/* ‚úÖ MODERN + NO CHOP LOGO (desktop + phones) */
.brand{
  display:flex; align-items:center; gap:12px;
  min-width:0;
}
.logoMark{
  height:56px;
  width:min(560px, 46vw);
  display:flex;
  align-items:center;
  justify-content:flex-start;
  overflow:visible;
}
.logoMark img{
  max-height:100%;
  max-width:100%;
  width:auto;
  height:auto;
  display:block;
  object-fit:contain;
  object-position:center;
  background:transparent !important;
  border:none !important;
  border-radius:0 !important;
  box-shadow:none !important;
  filter: drop-shadow(0 18px 36px rgba(0,0,0,.34));
}

nav{
  display:flex; align-items:center; gap:8px;
  overflow-x:auto;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
  padding:2px 2px;
}
nav::-webkit-scrollbar{display:none;}
nav a{
  text-decoration:none;
  font-weight:900;
  padding:10px 14px;
  border-radius:999px;
  color:var(--muted);
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.02);
  font-size:.88rem;
  white-space:nowrap;
  transition:transform .12s ease, filter .12s ease, background .12s ease, border-color .12s ease;
  user-select:none;
}
nav a:hover{filter:brightness(1.06); border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.03);}
nav a:active{transform:scale(.99)}
nav a.cta{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#0b0f14;
  border:none;
  box-shadow: 0 14px 28px rgba(244,196,48,.12);
}
nav a.vin-btn{background:rgba(15,23,42,.62); color:#fff}

/* ============ Layout ============ */
main{display:block}
.container{max-width:1200px; margin:0 auto; padding:0 16px;}

.hero{
  padding:44px 0 18px;
  display:grid;
  grid-template-columns: 1.06fr .94fr;
  gap:22px;
  align-items:start;
}
.hero h1{
  font-size:clamp(2.0rem, 4.7vw, 3.2rem);
  line-height:1.02;
  letter-spacing:-.9px;
}
.hero p{
  margin:14px 0 14px;
  color:var(--muted);
  max-width:58ch;
  line-height:1.6;
  font-size:1rem;
}

.badges{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px;}
.badge{
  display:inline-flex; align-items:center; gap:8px;
  padding:9px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(15,23,42,.46);
  font-weight:900;
  font-size:.86rem;
  backdrop-filter: blur(10px);
}
.badge .dot{
  width:8px;height:8px;border-radius:50%;
  background:var(--accent);
  box-shadow:0 0 0 3px rgba(244,196,48,.16);
}

.btnRow{display:flex; flex-wrap:wrap; gap:10px; margin-top:14px;}
.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:10px;
  padding:14px 16px;
  border-radius:14px;
  font-weight:950;
  text-decoration:none;
  user-select:none;
  transition:transform .12s ease, filter .12s ease, box-shadow .12s ease, border-color .12s ease;
}
.btn:active{transform:scale(.99)}
.btn.primary{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#0b0f14;
  border:none;
  box-shadow: 0 18px 40px rgba(244,196,48,.12);
}
.btn.secondary{
  background:rgba(255,255,255,.04);
  color:var(--text);
  border:1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(10px);
}
.btn.secondary:hover{border-color: rgba(255,255,255,.20); filter: brightness(1.05);}

.card{
  background:
    linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)),
    rgba(17,24,39,.68);
  border:1px solid rgba(255,255,255,.14);
  border-radius:var(--radius);
  box-shadow:var(--shadowSoft);
  padding:18px;
  backdrop-filter: blur(12px);
}
.card h3{font-size:1.05rem; letter-spacing:.2px;}

.grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px;}
.pillItem{
  display:flex; align-items:center; gap:10px;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(15,23,42,.54);
  color:var(--muted);
  font-weight:900;
  font-size:.93rem;
  transition: border-color .12s ease, transform .12s ease;
}
.pillItem:hover{border-color: rgba(255,255,255,.18); transform: translateY(-1px);}
.pillItem b{
  width:22px;height:22px;border-radius:50%;
  display:grid;place-items:center;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#0b0f14;
  font-size:.74rem;
  flex:0 0 auto;
}

.stats{
  margin-top:16px;
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.stat{
  padding:14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(15,23,42,.48);
  text-align:center;
  backdrop-filter: blur(10px);
  transition: border-color .12s ease, transform .12s ease;
}
.stat:hover{border-color: rgba(255,255,255,.18); transform: translateY(-1px);}
.stat strong{display:block; color:var(--accent); font-size:1.18rem; font-weight:950}
.stat span{display:block; margin-top:4px; color:var(--muted); font-size:.86rem; font-weight:850}

.section{padding:18px 0;}
.sectionTitleRow{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px; margin-bottom:10px;
}
.sectionTitleRow small{color:var(--muted); font-weight:850}

/* ‚úÖ FIX: show edit outline ONLY when admin mode is active */
body.adminMode .admin-edit{
  outline:2px dashed rgba(244,196,48,.78);
  outline-offset:6px;
  border-radius:14px;
  padding:10px;
}

/* ============ Forms ============ */
.formGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin-top:10px;
}
.formGrid .full{grid-column:1 / -1;}
textarea{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#0c121a;
  color:#fff;
  font-weight:800;
  min-height:110px;
  resize:vertical;
}
select{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#0c121a;
  color:#fff;
  font-weight:800;
}
.miniNote{
  margin-top:10px;
  color:var(--muted);
  font-size:.88rem;
  line-height:1.4;
}
.notice{
  margin-top:10px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(15,23,42,.40);
  border-radius:14px;
  padding:12px;
  color:#e5e7eb;
  font-weight:850;
  line-height:1.35;
}
.notice.ok{border-color:rgba(34,197,94,.35)}
.notice.bad{border-color:rgba(239,68,68,.30)}

/* ============ Trust / Reviews ============ */
.trustGrid{
  display:grid;
  grid-template-columns: 1.1fr .9fr;
  gap:12px;
  margin-top:10px;
}
.quoteCard{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(15,23,42,.44);
  border-radius:16px;
  padding:14px;
}
.quoteCard p{color:#e5e7eb;line-height:1.45;font-weight:800}
.quoteCard small{display:block;margin-top:8px;color:var(--muted);font-weight:900}
.trustList{display:grid; gap:10px;}
.trustItem{
  border:1px solid rgba(255,255,255,.14);
  background:rgba(15,23,42,.40);
  border-radius:16px;
  padding:12px;
  line-height:1.35;
}
.trustItem b{color:#fff}
.trustItem span{color:var(--muted);font-weight:850}

/* ============ Admin Bar ============ */
#adminBar{
  margin-top:10px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
#adminBar .left{display:flex; gap:10px; flex-wrap:wrap}
.pill{
  display:inline-flex; align-items:center; gap:10px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(0,0,0,.16);
  font-weight:900;
  font-size:.86rem;
  backdrop-filter: blur(10px);
}
.pill .tinyDot{
  width:10px;height:10px;border-radius:50%;
  background:rgba(255,255,255,.18);
  box-shadow:0 0 0 3px rgba(255,255,255,.06);
}
.pill.ok{border-color:rgba(34,197,94,.35)}
.pill.ok .tinyDot{background:var(--ok); box-shadow:0 0 0 3px rgba(34,197,94,.18)}
.pill.bad{border-color:rgba(239,68,68,.30)}
.pill.bad .tinyDot{background:var(--bad); box-shadow:0 0 0 3px rgba(239,68,68,.18)}
.pill.warn{border-color:rgba(245,158,11,.30)}
.pill.warn .tinyDot{background:var(--warn); box-shadow:0 0 0 3px rgba(245,158,11,.18)}
.pillBtn{
  display:inline-flex; align-items:center; gap:10px;
  padding:10px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.02);
  color:#fff;
  font-weight:950;
  cursor:pointer;
  user-select:none;
}
.pillBtn:hover{filter:brightness(1.06); border-color: rgba(255,255,255,.20);}
.pillBtn:active{transform:scale(.99)}
.pulse{
  position:relative;
}
.pulse::after{
  content:"";
  position:absolute;
  right:8px; top:8px;
  width:10px; height:10px;
  border-radius:999px;
  background:var(--accent);
  box-shadow:0 0 0 0 rgba(244,196,48,.55);
  animation:pulse 1.3s infinite;
}
@keyframes pulse{
  0%{ box-shadow:0 0 0 0 rgba(244,196,48,.55); }
  70%{ box-shadow:0 0 0 10px rgba(244,196,48,0); }
  100%{ box-shadow:0 0 0 0 rgba(244,196,48,0); }
}

/* ============ Gallery Category Tabs ============ */
.tabs{
  display:flex; flex-wrap:wrap; gap:8px;
  margin-top:12px;
}
.tab{
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.02);
  color:var(--muted);
  border-radius:999px;
  padding:9px 12px;
  font-weight:950;
  cursor:pointer;
  user-select:none;
  transition: border-color .12s ease, filter .12s ease, background .12s ease, transform .12s ease;
}
.tab:hover{border-color: rgba(255,255,255,.18); filter: brightness(1.04);}
.tab:active{transform:scale(.99)}
.tab.active{
  color:#0b0f14;
  border:none;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}

/* ============ Gallery (Carousel) ============ */
.galleryWrap{position:relative; margin-top:10px;}
#galleryGrid{
  display:flex;
  gap:14px;
  overflow-x:auto;
  padding:8px 6px 12px;
  scroll-snap-type:x mandatory;
  scroll-behavior:smooth;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
#galleryGrid::-webkit-scrollbar{display:none;}
.galleryItem{
  flex:0 0 auto;
  width:220px;
  aspect-ratio: 3 / 4;
  scroll-snap-align:start;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(15,23,42,.52);
  overflow:hidden;
  display:flex;align-items:center;justify-content:center;
  color:var(--muted);font-weight:900;position:relative;
  box-shadow: 0 16px 34px rgba(0,0,0,.32);
  cursor:pointer;
  transition: transform .14s ease, border-color .14s ease, filter .14s ease;
}
.galleryItem:hover{transform: translateY(-2px); border-color: rgba(255,255,255,.18); filter: brightness(1.04);}
.galleryItem img{width:100%;height:100%;object-fit:cover;display:block;}
.galleryItem::after{
  content:"";
  position:absolute;inset:0;
  background:linear-gradient(180deg, rgba(0,0,0,0) 60%, rgba(0,0,0,.55) 100%);
  pointer-events:none;
}
.galleryItem .cap{
  position:absolute;left:10px;right:10px;bottom:10px;
  background:rgba(0,0,0,.52);
  border:1px solid rgba(255,255,255,.14);
  padding:8px 10px;border-radius:12px;
  color:#fff;font-size:.78rem;font-weight:950;
  z-index:2;
  backdrop-filter: blur(10px);
}
.galleryItem .del{
  position:absolute;top:10px;right:10px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.18);
  color:#fff;border-radius:12px;padding:8px 10px;
  font-weight:950;cursor:pointer;display:none;
  z-index:3;
}
.galleryItem.admin .del{display:block}

.galleryNav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  z-index:5;
  width:42px;height:42px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(11,15,20,.68);
  backdrop-filter: blur(12px);
  color:#fff;
  cursor:pointer;
  user-select:none;
  box-shadow:0 18px 40px rgba(0,0,0,.35);
  display:flex; align-items:center; justify-content:center;
}
.galleryNav:active{transform:translateY(-50%) scale(.98)}
.galleryNav.left{left:10px}
.galleryNav.right{right:10px}
.galleryNav[disabled]{opacity:.35;cursor:default;pointer-events:none}

/* ============ Lightbox ============ */
#lightboxBackdrop{
  position:fixed; inset:0;
  background:rgba(0,0,0,.72);
  backdrop-filter: blur(12px);
  display:none;
  z-index:5000;
  padding:14px;
}
#lightboxModal{
  position:relative;
  width:min(1100px, 100%);
  height:min(86vh, 900px);
  margin:0 auto;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.14);
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)), #0b0f14;
  box-shadow:0 40px 90px rgba(0,0,0,.75);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}
#lbStage{flex:1; display:grid; place-items:center; padding:14px;}
#lbImg{
  max-width:100%;
  max-height:100%;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 20px 60px rgba(0,0,0,.55);
  object-fit:contain;
}
.lbCap{
  padding:10px 14px;
  border-top:1px solid rgba(255,255,255,.10);
  color:#e5e7eb;
  background:rgba(0,0,0,.30);
  font-weight:900;
  font-size:.9rem;
  min-height:46px;
  display:flex;
  align-items:center;
}
#lbClose{
  position:absolute; top:12px; right:12px;
  width:40px;height:40px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.45);
  color:#fff;
  font-weight:950;
  cursor:pointer;
  z-index:2;
}
.lbArrow{
  position:absolute; top:50%;
  transform:translateY(-50%);
  width:44px;height:44px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.45);
  color:#fff;
  font-size:22px;
  cursor:pointer;
  z-index:2;
}
#lbPrev{left:12px}
#lbNext{right:12px}
.lbArrow[disabled]{opacity:.35;cursor:default;pointer-events:none}

/* ============ Footer ============ */
footer{
  margin-top:10px;
  border-top:1px solid rgba(255,255,255,.08);
  padding:22px 16px 86px;
}
.footer-inner{
  max-width:1200px; margin:0 auto;
  display:grid; gap:10px;
}
.footerRow{
  display:flex; flex-wrap:wrap;
  justify-content:space-between;
  gap:12px;
  align-items:flex-start;
}
footer span{color:var(--muted); font-size:.92rem; line-height:1.35}
.footerLinks{display:flex;flex-wrap:wrap;gap:10px;}
.footerLinks a{
  color:var(--text);text-decoration:none;
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.02);
  padding:8px 12px;border-radius:999px;font-weight:900;font-size:.85rem;
  transition: border-color .12s ease, filter .12s ease, background .12s ease;
}
.footerLinks a:hover{border-color: rgba(255,255,255,.18); background: rgba(255,255,255,.03); filter: brightness(1.04);}

/* ============ VIN Panel ============ */
#vin-panel-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;z-index:997;}
#vin-panel{
  position:fixed;left:50%;transform:translateX(-50%);
  bottom:18px;width:360px;max-height:82vh;
  background:#0b1210;border-radius:18px;padding:14px;
  display:none;box-shadow:0 30px 60px rgba(0,0,0,.75);
  z-index:998;border:1px solid rgba(255,255,255,.12);
}
#vin-head{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;}
#vin-head strong{font-size:.95rem}
#vin-close{
  border:1px solid rgba(255,255,255,.18);
  background:#0f1714;color:#fff;border-radius:12px;
  padding:8px 10px;font-weight:950;cursor:pointer;
}
#vin-meta{color:#aeb8c2;font-size:.82rem;margin-bottom:10px;line-height:1.3;}
#vin-panel input{
  width:100%;padding:12px;border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#0c1612;color:#fff;text-transform:uppercase;letter-spacing:.6px;
}
#vin-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px;}
#vin-panel button{
  width:100%;
  padding:11px;
  border-radius:12px;
  border:none;
  font-weight:950;
  cursor:pointer;
}
#vin-panel button.primary{background:linear-gradient(135deg,var(--accent),var(--accent2)); color:#0b0f14;}
#vin-panel button.secondary{background:#0f1714;color:#fff;border:1px solid rgba(255,255,255,.18);}
#vin-status{margin-top:10px;font-size:12px;min-height:18px;color:#9bb0a6;display:flex;align-items:center;gap:8px;}
.dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.18);box-shadow:0 0 0 3px rgba(255,255,255,.06);}
#vin-status.ok{color:var(--ok)} #vin-status.ok .dot{background:var(--ok);box-shadow:0 0 0 3px rgba(34,197,94,.18)}
#vin-status.bad{color:var(--bad)} #vin-status.bad .dot{background:var(--bad);box-shadow:0 0 0 3px rgba(239,68,68,.18)}
#vin-status.warn{color:var(--warn)} #vin-status.warn .dot{background:var(--warn);box-shadow:0 0 0 3px rgba(245,158,11,.18)}
#vin-panel #results{max-height:38vh;overflow-y:auto;-webkit-overflow-scrolling:touch;margin-top:10px;padding-right:2px;}
.row{
  display:flex;justify-content:space-between;gap:12px;
  background:#0f1714;padding:9px 10px;border-radius:12px;margin-top:8px;font-size:12px;
  border:1px solid rgba(255,255,255,.08);
  cursor:pointer;
  transition: border-color .12s ease, transform .12s ease, filter .12s ease;
}
.row:hover{border-color: rgba(255,255,255,.14); filter: brightness(1.05); transform: translateY(-1px);}
.k{color:#9bb0a6;max-width:60%} .v{font-weight:950;text-align:right;max-width:40%;overflow-wrap:anywhere}
.vehicle{text-align:center;font-weight:950;margin-top:10px}

/* Toast */
.toast{
  position:fixed;left:50%;transform:translateX(-50%);
  bottom:calc(env(safe-area-inset-bottom) + 78px);
  background:rgba(15,23,42,.92);border:1px solid rgba(255,255,255,.12);
  padding:10px 12px;border-radius:12px;font-size:12px;color:var(--text);
  display:none;z-index:9999;box-shadow:0 20px 40px rgba(0,0,0,.45);
}

/* Modals */
#adminModalBackdrop,#addModalBackdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.62);
  display:none; z-index:2000;
}
#adminModal,#addModal{
  position:fixed; left:50%; top:50%; transform:translate(-50%,-50%);
  width:min(560px, calc(100% - 24px));
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)), var(--panel);
  border:1px solid rgba(255,255,255,.14);
  border-radius:18px; box-shadow:0 30px 80px rgba(0,0,0,.7);
  padding:16px; display:none; z-index:2001;
}
.modalHead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;}
.modalHead strong{font-size:1rem}
.iconBtn{
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.12);
  color:#fff;border-radius:12px;padding:8px 10px;font-weight:950;cursor:pointer;
  transition: filter .12s ease, border-color .12s ease;
}
.iconBtn:hover{filter: brightness(1.06); border-color: rgba(255,255,255,.22);}
.field{margin-top:10px;}
.field label{display:block;font-size:.85rem;color:var(--muted);font-weight:900;margin-bottom:6px;}
.field input{
  width:100%;padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,.15);
  background:#0c121a;color:#fff;font-weight:800;
}
.field input:focus, select:focus, textarea:focus{border-color: rgba(244,196,48,.45);}
.modalActions{display:flex;gap:10px;margin-top:12px;}
.modalActions button{flex:1}
.helper{margin-top:10px;color:var(--muted);font-size:.85rem;line-height:1.35;}

/* ============ Sticky Mobile Action Bar ============ */
#ctaDock{
  position:fixed;
  left:0; right:0;
  bottom:0;
  z-index:9990;
  padding:10px 12px calc(env(safe-area-inset-bottom) + 10px);
  background:rgba(11,15,20,.78);
  backdrop-filter: blur(14px);
  border-top:1px solid rgba(255,255,255,.10);
}
.ctaInner{
  max-width:1200px;
  margin:0 auto;
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:10px;
}
.ctaBtn{
  display:flex; align-items:center; justify-content:center; gap:8px;
  padding:12px 10px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.14);
  background:rgba(255,255,255,.03);
  color:#fff;
  text-decoration:none;
  font-weight:950;
  user-select:none;
  transition: transform .12s ease, filter .12s ease, border-color .12s ease;
  text-align:center;
}
.ctaBtn:active{transform:scale(.99)}
.ctaBtn:hover{filter:brightness(1.05); border-color: rgba(255,255,255,.20);}
.ctaBtn.primary{
  border:none;
  color:#0b0f14;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
}

/* ============ Responsive ============ */
@media(max-width:900px){
  .hero{grid-template-columns:1fr; padding:28px 0 14px;}
}
@media(max-width:600px){
  .header-inner{
    flex-wrap:wrap;
    justify-content:center;
    gap:10px;
    padding:10px 12px;
  }
  .brand{width:100%; justify-content:center;}
  .logoMark{
    width:min(720px, 94vw);
    height:66px;
    justify-content:center;
  }
  nav{
    width:100%;
    justify-content:flex-start;
    padding-bottom:6px;
    padding-left:2px;
    padding-right:2px;
  }
  nav a{
    padding:11px 14px;
    font-size:.92rem;
    flex-shrink:0;
  }
  .container{padding:0 12px;}
  .btnRow .btn{width:100%}
  .stats{grid-template-columns:1fr}
  .grid2{grid-template-columns:1fr}
  .formGrid{grid-template-columns:1fr}
  .trustGrid{grid-template-columns:1fr}
  #vin-panel{
    left:0; right:0;
    bottom:env(safe-area-inset-bottom);
    width:100%;
    max-height:78vh;
    transform:none;
    border-radius:18px 18px 0 0;
  }
  .galleryItem{width:78vw; max-width:340px;}
  .galleryNav{display:none;}
  #lightboxModal{height:90vh;}
}
</style>

<!-- LocalBusiness Structured Data -->
<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@type":"AutoPartsStore",
  "name":"Two Little Bees Auto Parts",
  "url":"https://twolittlebeesautoparts.github.io/OFFICIALPAGE/",
  "image":"https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/new.logo.png?raw=true",
  "telephone":"+1-317-243-7777",
  "address":{
    "@type":"PostalAddress",
    "streetAddress":"507 S Tibbs Ave",
    "addressLocality":"Indianapolis",
    "addressRegion":"IN",
    "addressCountry":"US"
  },
  "areaServed":"Indianapolis, IN",
  "description":"VIN-verified OEM used parts ‚Äî engines, transmissions, modules, body parts, wheels and more."
}
</script>
</head>

<body>
<div class="toast" id="toast">Copied</div>

<header>
  <div class="header-inner">
    <div class="brand">
      <div class="logoMark">
        <img
          alt="Two Little Bees Auto Parts"
          src="https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/new.logo.png?raw=true"
        />
      </div>
    </div>

    <nav>
      <a href="#top">Home</a>
      <a class="cta" href="https://twolittlebeesautoparts.github.io/OFFICIALPAGE/">Inventory</a>
      <a href="parts.html">Car Parts</a>
      <a href="#request">Request a Part</a>
      <a href="#junkcars">Cash for Junk Cars</a>
      <a href="javascript:void(0)" class="vin-btn" onclick="toggleVin()">VIN</a>
    </nav>
  </div>
</header>

<main id="top">
  <div class="container">

    <!-- HERO -->
    <section class="hero">
      <div>
        <h1>The Right Parts.<br>Every Time.<br>Built on Trust.</h1>

        <div class="badges">
          <div class="badge"><span class="dot"></span> Established in Indianapolis</div>
          <div class="badge"><span class="dot"></span> VIN-Verified</div>
          <div class="badge"><span class="dot"></span> Fast Counter Support</div>
        </div>

        <p>Live inventory tied to real vehicles. Call or request a quote ‚Äî we verify fitment, move fast, and keep it simple.</p>

        <div class="btnRow">
          <a class="btn primary" href="https://twolittlebeesautoparts.github.io/">Search Inventory</a>
          <a class="btn secondary" href="#request">üí¨ Request a Part</a>
          <a class="btn secondary" href="tel:3172437777">üìû Call (317) 243-7777</a>
          <a class="btn secondary" href="https://www.google.com/maps?q=507+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener">Get Directions</a>
        </div>

        <!-- ‚úÖ LIVE COUNTERS (auto updates from Firestore) -->
        <div class="stats">
          <div class="stat"><strong id="statViews">‚Äî</strong><span>Total Website Views</span></div>
          <div class="stat"><strong id="statUniqueToday">‚Äî</strong><span>Unique Visitors Today</span></div>
          <div class="stat"><strong>1985‚Äì2026</strong><span>Coverage</span></div>
        </div>

        <div class="miniNote" style="margin-top:10px">
          <span style="color:var(--muted);font-weight:850">Tip:</span> You‚Äôll see live visitor numbers above. Admins can also enable lead notifications in the Gallery section.
        </div>
      </div>

      <div class="card">
        <h3>What We Sell</h3>
        <div class="grid2">
          <div class="pillItem"><b>‚úì</b> Engines & Transmissions</div>
          <div class="pillItem"><b>‚úì</b> Suspension & Drivetrain</div>
          <div class="pillItem"><b>‚úì</b> Body & Interior</div>
          <div class="pillItem"><b>‚úì</b> Electrical Modules</div>
          <div class="pillItem"><b>‚úì</b> OEM Used Parts</div>
          <div class="pillItem"><b>‚úì</b> VIN-Verified Fitment</div>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section class="section">
      <div class="card">
        <div class="sectionTitleRow">
          <h3>About Us</h3>
          <small>Ctrl + Shift + A to edit</small>
        </div>

        <div id="aboutText" class="admin-edit">
          Two Little Bees Auto Parts is a locally owned auto parts business based in Indianapolis, focused on providing quality OEM used parts pulled from real vehicles.
          <br><br>
          We specialize in VIN-verified parts, making sure every engine, transmission, module, or body component is correctly matched before it ever leaves our yard.
          That means fewer mistakes, no guesswork, and confidence that the part you‚Äôre buying is the right one.
          <br><br>
          Serving local repair shops, dealerships, and walk-in customers, we cover vehicles from 1985‚Äì2026 and maintain live inventory tied directly to the cars we dismantle.
          When you call, you talk to someone who knows parts.
          <br><br>
          Built in Indianapolis and grounded in trust ‚Äî accurate parts, straight answers, no wasted time.
        </div>
      </div>
    </section>

    <!-- TRUST + REVIEWS -->
    <section class="section" id="trust">
      <div class="card">
        <div class="sectionTitleRow">
          <h3>Trust & Reviews</h3>
          <small>What customers care about</small>
        </div>

        <div class="trustGrid">
          <div class="quoteCard">
            <p>‚ÄúWe verify fitment using VIN and vehicle data so you don‚Äôt waste time. If it doesn‚Äôt match, we‚Äôll tell you before you buy.‚Äù</p>
            <small>‚Äî Two Little Bees Auto Parts</small>

            <div class="notice" style="margin-top:12px">
              <b>Warranty / Returns:</b>
              <div style="margin-top:6px;color:var(--muted);font-weight:850;line-height:1.35">
                Ask your salesperson for warranty options on engines/transmissions and any return rules for your specific part. We keep it simple and clear at the counter.
              </div>
            </div>

            <div class="btnRow" style="margin-top:12px">
              <a class="btn secondary" target="_blank" rel="noopener"
                 href="https://www.google.com/search?q=Two+Little+Bees+Auto+Parts+Indianapolis+reviews">
                ‚≠ê View / Leave a Google Review
              </a>
              <a class="btn secondary" href="tel:3172437777">üìû Call Now</a>
            </div>
          </div>

          <div class="trustList">
            <div class="trustItem"><b>VIN-Verified Fitment</b><br><span>We match parts to real vehicles and confirm details before you pay.</span></div>
            <div class="trustItem"><b>Fast Support</b><br><span>Call ‚Äî we respond quick and keep the process simple.</span></div>
            <div class="trustItem"><b>Local & Reliable</b><br><span>Indianapolis-based. Built on repeat customers and shop relationships.</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- REQUEST A PART -->
    <section class="section" id="request">
      <div class="card">
        <div class="sectionTitleRow">
          <h3>Request a Part</h3>
          <small>We‚Äôll call you back</small>
        </div>

        <div class="miniNote">
          Fill this out and we‚Äôll contact you by phone.
        </div>

        <div class="formGrid">
          <div class="field">
            <label for="rqName">Name</label>
            <input id="rqName" type="text" placeholder="Your name" autocomplete="name">
          </div>
          <div class="field">
            <label for="rqPhone">Phone</label>
            <input id="rqPhone" type="tel" placeholder="(317) 555-1234" autocomplete="tel">
          </div>

          <div class="field">
            <label for="rqYear">Year</label>
            <input id="rqYear" type="text" placeholder="2016" inputmode="numeric">
          </div>
          <div class="field">
            <label for="rqMakeModel">Make / Model</label>
            <input id="rqMakeModel" type="text" placeholder="Chevy Malibu">
          </div>

          <div class="field">
            <label for="rqPart">Part Needed</label>
            <input id="rqPart" type="text" placeholder="Transmission, engine, bumper, wheel...">
          </div>
          <div class="field">
            <label for="rqVin">VIN (optional)</label>
            <input id="rqVin" type="text" placeholder="17-char VIN" maxlength="17" style="text-transform:uppercase;letter-spacing:.6px">
          </div>

          <div class="field full">
            <label for="rqNotes">Notes (optional)</label>
            <textarea id="rqNotes" placeholder="Any details: trim, engine size, 2WD/4WD, color, part number, etc."></textarea>
          </div>

          <div class="field full">
            <label for="rqPhotoUrl">Photo link (optional)</label>
            <input id="rqPhotoUrl" type="url" placeholder="https://... (label/photo link)">
          </div>

          <div class="modalActions full" style="margin-top:2px">
            <button class="btn primary" id="rqSubmit" type="button">Send Request</button>
            <a class="btn secondary" href="tel:3172437777" style="text-align:center">üìû Call Now</a>
          </div>
        </div>

        <div id="rqStatus" class="notice" style="display:none"></div>
      </div>
    </section>

    <!-- CASH FOR JUNK CARS -->
    <section class="section" id="junkcars">
      <div class="card">
        <div class="sectionTitleRow">
          <h3>Cash for Junk Cars</h3>
          <small>Same-day pickup (when available)</small>
        </div>

        <div class="notice">
          <b>We buy junk cars.</b> Top dollar paid. Quick pickup. Title helps ‚Äî if you‚Äôre unsure, still submit and we‚Äôll tell you what you need.
        </div>

        <div class="formGrid" style="margin-top:12px">
          <div class="field">
            <label for="jcName">Name</label>
            <input id="jcName" type="text" placeholder="Your name" autocomplete="name">
          </div>
          <div class="field">
            <label for="jcPhone">Phone</label>
            <input id="jcPhone" type="tel" placeholder="(317) 555-1234" autocomplete="tel">
          </div>

          <div class="field">
            <label for="jcLocation">Pickup Location</label>
            <input id="jcLocation" type="text" placeholder="Address or zip code">
          </div>
          <div class="field">
            <label for="jcVehicle">Vehicle (Year / Make / Model)</label>
            <input id="jcVehicle" type="text" placeholder="2010 Honda Accord">
          </div>

          <div class="field">
            <label for="jcRuns">Does it run?</label>
            <select id="jcRuns">
              <option value="">Select</option>
              <option>Yes</option>
              <option>No</option>
              <option>Not sure</option>
            </select>
          </div>
          <div class="field">
            <label for="jcTitle">Do you have the title?</label>
            <select id="jcTitle">
              <option value="">Select</option>
              <option>Yes</option>
              <option>No</option>
              <option>Not sure</option>
            </select>
          </div>

          <div class="field full">
            <label for="jcNotes">Notes (optional)</label>
            <textarea id="jcNotes" placeholder="Any info: damage, missing wheels, location details, best time to pickup, etc."></textarea>
          </div>

          <div class="modalActions full" style="margin-top:2px">
            <button class="btn primary" id="jcSubmit" type="button">Get an Offer</button>
            <a class="btn secondary" href="tel:3172437777" style="text-align:center">üìû Call Now</a>
          </div>
        </div>

        <div id="jcStatus" class="notice" style="display:none"></div>
      </div>
    </section>

    <!-- GALLERY -->
    <section class="section" style="padding-top:0">
      <div class="card">
        <div class="sectionTitleRow">
          <h3>Gallery</h3>
          <small id="galleryHint">Public view</small>
        </div>

        <div id="adminBar">
          <div class="left">
            <button class="btn secondary" id="adminLoginOpen" type="button">Admin Login</button>
            <button class="btn secondary" id="adminLogout" type="button" style="display:none">Logout</button>
            <button class="btn primary" id="addPhotoOpen" type="button" style="display:none">Add Photo</button>

            <!-- ‚úÖ ADMIN-ONLY: lead notifications -->
            <button class="pillBtn" id="notifToggle" type="button" style="display:none" title="Enable desktop notifications">üîî Alerts: OFF</button>
            <div class="pill warn" id="leadPill" style="display:none">
              <span class="tinyDot"></span>
              <span id="leadText">Leads: 0 new</span>
            </div>
          </div>

          <div class="pill bad" id="authPill">
            <span class="tinyDot"></span>
            <span id="authText">Not signed in</span>
          </div>
        </div>

        <div class="tabs" id="galleryTabs" aria-label="Gallery categories">
          <button class="tab active" type="button" data-cat="All">All</button>
          <button class="tab" type="button" data-cat="Engines">Engines</button>
          <button class="tab" type="button" data-cat="Transmissions">Transmissions</button>
          <button class="tab" type="button" data-cat="New Arrivals">New Arrivals</button>
          <button class="tab" type="button" data-cat="Yard">Yard</button>
          <button class="tab" type="button" data-cat="General">General</button>
        </div>

        <div class="galleryWrap">
          <button class="galleryNav left" id="gPrev" type="button" aria-label="Scroll left">‚Äπ</button>
          <button class="galleryNav right" id="gNext" type="button" aria-label="Scroll right">‚Ä∫</button>

          <div id="galleryGrid">
            <div class="galleryItem" id="galleryLoading">Loading gallery‚Ä¶</div>
          </div>
        </div>

        <div class="miniNote">
          Tip: Tap a photo to open full screen. Categories help customers see what you have fast.
        </div>
      </div>
    </section>

  </div>
</main>

<footer>
  <div class="footer-inner">
    <div class="footerRow">
      <span>¬© 2026 Two Little Bees Auto Parts</span>
      <span>
        üìû <a href="tel:3172437777" style="color:inherit;text-decoration:none">(317) 243-7777</a><br>
        üìç <a href="https://www.google.com/maps?q=507+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener" style="color:inherit;text-decoration:none">507 S Tibbs Ave, Indianapolis</a>
      </span>
    </div>

    <div class="footerLinks">
      <a href="https://twolittlebeesautoparts.github.io/OFFICIALPAGE/">Inventory</a>
      <a href="parts.html">Car Parts</a>
      <a href="#request">Request a Part</a>
      <a href="#junkcars">Cash for Junk Cars</a>
      <a href="javascript:void(0)" onclick="toggleVin()">VIN Decoder</a>
      <a href="tel:3172437777">Call</a>
      <a href="https://www.google.com/maps?q=507+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener">Directions</a>
    </div>
  </div>
</footer>

<!-- Sticky CTA Dock -->
<div id="ctaDock" role="navigation" aria-label="Quick actions">
  <div class="ctaInner">
    <a class="ctaBtn" href="tel:3172437777" aria-label="Call Two Little Bees">(üìû) Call</a>
    <a class="ctaBtn" href="https://www.google.com/maps?q=507+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener" aria-label="Directions">(üìç) Directions</a>
    <a class="ctaBtn primary" href="#request" aria-label="Request a part">(üß∞) Quote</a>
    <a class="ctaBtn" href="#junkcars" aria-label="Cash for junk cars">(üöó) Junk</a>
  </div>
</div>

<!-- VIN -->
<div id="vin-panel-backdrop" onclick="toggleVin()"></div>
<div id="vin-panel" role="dialog" aria-modal="true" aria-label="VIN Decoder">
  <div id="vin-head">
    <strong>VIN Decoder</strong>
    <button id="vin-close" type="button" onclick="toggleVin()">Close</button>
  </div>
  <div id="vin-meta">Two Little Bees Auto Parts ‚Ä¢ (317) 243-7777 ‚Ä¢ Indianapolis</div>
  <input id="vin" maxlength="17" placeholder="ENTER 17-CHAR VIN" autocomplete="off" />
  <div id="vin-actions">
    <button class="primary" type="button" onclick="decode()">Decode VIN</button>
    <button class="secondary" type="button" onclick="printSheet()">Print VIN Sheet</button>
  </div>
  <div id="vin-status"><span class="dot"></span><span id="vin-status-text"></span></div>
  <div id="vehicle" class="vehicle"></div>
  <div id="results"></div>
</div>

<!-- Admin Login Modal -->
<div id="adminModalBackdrop"></div>
<div id="adminModal" role="dialog" aria-modal="true" aria-label="Admin Login">
  <div class="modalHead">
    <strong>Admin Login</strong>
    <button class="iconBtn" id="adminModalClose" type="button">Close</button>
  </div>
  <div class="field">
    <label for="adminEmail">Email</label>
    <input id="adminEmail" type="email" placeholder="your admin email" autocomplete="username">
  </div>
  <div class="field">
    <label for="adminPass">Password</label>
    <input id="adminPass" type="password" placeholder="your password" autocomplete="current-password">
  </div>
  <div class="modalActions">
    <button class="btn secondary" id="adminCancel" type="button">Cancel</button>
    <button class="btn primary" id="adminLoginDo" type="button">Login</button>
  </div>
  <div class="helper" id="adminMsg">Sign in using your Firebase user (Authentication ‚Üí Users).</div>
</div>

<!-- Add Photo Modal -->
<div id="addModalBackdrop"></div>
<div id="addModal" role="dialog" aria-modal="true" aria-label="Add Gallery Photo">
  <div class="modalHead">
    <strong>Add Gallery Photo</strong>
    <button class="iconBtn" id="addModalClose" type="button">Close</button>
  </div>
  <div class="field">
    <label for="photoUrl">Photo URL (public link)</label>
    <input id="photoUrl" type="url" placeholder="https://..." autocomplete="off">
  </div>
  <div class="field">
    <label for="photoCaption">Caption (optional)</label>
    <input id="photoCaption" type="text" placeholder="Engine arrivals, shop, yard, etc." autocomplete="off">
  </div>
  <div class="field">
    <label for="photoCategory">Category</label>
    <select id="photoCategory">
      <option>General</option>
      <option>Engines</option>
      <option>Transmissions</option>
      <option>New Arrivals</option>
      <option>Yard</option>
    </select>
  </div>
  <div class="modalActions">
    <button class="btn secondary" id="addCancel" type="button">Cancel</button>
    <button class="btn primary" id="addDo" type="button">Add</button>
  </div>
  <div class="helper" id="addMsg">Tip: use a direct image URL (ends in .jpg/.png/.webp) or a public Googleusercontent link.</div>
</div>

<!-- Lightbox -->
<div id="lightboxBackdrop" aria-hidden="true">
  <div id="lightboxModal" role="dialog" aria-modal="true" aria-label="Gallery image">
    <button id="lbClose" type="button" aria-label="Close">‚úï</button>
    <button class="lbArrow" id="lbPrev" type="button" aria-label="Previous">‚Äπ</button>
    <button class="lbArrow" id="lbNext" type="button" aria-label="Next">‚Ä∫</button>
    <div id="lbStage">
      <img id="lbImg" alt="Gallery large view" />
    </div>
    <div id="lbCap" class="lbCap"></div>
  </div>
</div>

<script>
/* ===== Smooth hash scrolling ===== */
(function(){
  const links = document.querySelectorAll('a[href^="#"]');
  links.forEach(a=>{
    a.addEventListener("click", (e)=>{
      const href = a.getAttribute("href");
      if(!href || href === "#") return;
      const el = document.querySelector(href);
      if(!el) return;
      e.preventDefault();
      el.scrollIntoView({ behavior:"smooth", block:"start" });
      history.pushState(null, "", href);
    });
  });
})();

/* ===== VIN Decoder ===== */
const vinPanel = document.getElementById("vin-panel");
const vinBackdrop = document.getElementById("vin-panel-backdrop");
const vinInput = document.getElementById("vin");
const resultsEl = document.getElementById("results");
const vehicleEl = document.getElementById("vehicle");
const vinStatus = document.getElementById("vin-status");
const vinStatusText = document.getElementById("vin-status-text");
const toast = document.getElementById("toast");

let vinBusy = false;
let lastVinCache = { vin:"", d:null, ts:0 };

function setVinStatus(msg, type=""){
  vinStatusText.textContent = msg || "";
  vinStatus.className = type ? type : "";
}

function toggleVin(force){
  const isOpen = vinPanel.style.display === "block";
  const next = (force === undefined) ? !isOpen : !!force;
  vinPanel.style.display = next ? "block" : "none";
  vinBackdrop.style.display = next ? "block" : "none";
  document.body.style.overflow = next ? "hidden" : "";
  if(next) setTimeout(()=> vinInput.focus(), 60);
}

document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape" && vinPanel.style.display === "block") toggleVin(false);
});

function cleanVIN(v){ return (v||"").toUpperCase().replace(/[^A-Z0-9]/g,""); }
function validVIN(v){ return v.length === 17 && !/[IOQ]/.test(v); }

vinInput.addEventListener("input", ()=>{
  const c = cleanVIN(vinInput.value);
  if(vinInput.value !== c) vinInput.value = c;
  if(c.length === 17 && validVIN(c)) setVinStatus("Ready to decode.", "");
  else if(c.length) setVinStatus("Enter 17 chars (no I/O/Q).", "warn");
  else setVinStatus("", "");
});

vinInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){ e.preventDefault(); decode(); }
});

async function fetchDecode(v){
  const direct = `https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVinValuesExtended/${v}?format=json`;
  try{
    const r1 = await fetch(direct, { cache:"no-store" });
    if(!r1.ok) throw new Error("Direct failed");
    return await r1.json();
  }catch{
    const proxy = "https://api.allorigins.win/raw?url=" + encodeURIComponent(direct);
    const r2 = await fetch(proxy, { cache:"no-store" });
    if(!r2.ok) throw new Error("Proxy failed");
    return await r2.json();
  }
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, (m)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
  }[m]));
}

function row(k, v){
  if(!v || v === "Not Applicable") return;
  const safeK = escapeHtml(k);
  const safeV = escapeHtml(v);
  resultsEl.insertAdjacentHTML("beforeend", `
    <div class="row" data-copy="${safeV}">
      <div class="k">${safeK}</div>
      <div class="v">${safeV}</div>
    </div>
  `);
}

function showToast(msg){
  toast.textContent = msg;
  toast.style.display = "block";
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=> toast.style.display="none", 900);
}

document.addEventListener("click", async (e)=>{
  const r = e.target.closest("#results .row");
  if(!r) return;
  const text = r.getAttribute("data-copy");
  if(!text) return;
  try{
    await navigator.clipboard.writeText(text);
    showToast("Copied");
  }catch{
    const ta = document.createElement("textarea");
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    showToast("Copied");
  }
});

async function decode(){
  let v = cleanVIN(vinInput.value);
  vinInput.value = v;

  if(!validVIN(v)){
    setVinStatus("Invalid VIN. Must be 17 chars and no I/O/Q.", "bad");
    return;
  }
  if(vinBusy) return;
  vinBusy = true;

  const now = Date.now();
  if(lastVinCache.vin === v && lastVinCache.d && (now - lastVinCache.ts) < 60_000){
    renderVin(lastVinCache.d, v);
    setVinStatus("Loaded from cache.", "ok");
    vinBusy = false;
    return;
  }

  setVinStatus("Decoding VIN‚Ä¶", "warn");
  resultsEl.innerHTML = "";
  vehicleEl.textContent = "Decoding‚Ä¶";

  try{
    const json = await fetchDecode(v);
    const d = json?.Results?.[0] || {};
    lastVinCache = { vin:v, d, ts:Date.now() };
    renderVin(d, v);
    setVinStatus("VIN decoded successfully.", "ok");
  }catch{
    vehicleEl.textContent = "Decode failed.";
    setVinStatus("Decode failed. Check internet and try again.", "bad");
  }
  vinBusy = false;
}

function renderVin(d, v){
  const line = `${d.ModelYear || ""} ${d.Make || ""} ${d.Model || ""}`.trim() || "Vehicle";
  vehicleEl.textContent = line;

  row("VIN", v);
  row("Year", d.ModelYear);
  row("Make", d.Make);
  row("Model", d.Model);
  row("Trim", d.Trim);
  row("Engine", d.EngineModel || (d.DisplacementL ? `${d.DisplacementL}L` : ""));
  row("Displacement", d.DisplacementL ? `${d.DisplacementL} L` : "");
  row("Cylinders", d.EngineCylinders);
  row("Fuel", d.FuelTypePrimary);
  row("Transmission", d.TransmissionStyle);
  row("Trans Speeds", d.TransmissionSpeeds);
  row("Drive", d.DriveType);
  row("Body", d.BodyClass);
  row("Doors", d.Doors);
  row("Vehicle Type", d.VehicleType);
  row("GVWR", d.GVWR);
}

/* ‚úÖ PRINT: safe + no page wipe */
function printSheet(){
  const logo = "https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/new.logo.png?raw=true";
  const html = `
<!doctype html><html><head><meta charset="utf-8">
<title>VIN Sheet</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;padding:22px;background:#fff;color:#000}
  .top{display:flex;gap:14px;align-items:center}
  img{height:62px;object-fit:contain}
  h2{margin:0;font-size:18px;letter-spacing:.4px}
  p{margin:4px 0 0;color:#111}
  hr{margin:14px 0;border:none;border-top:1px solid #ddd}
  .row{display:flex;justify-content:space-between;gap:14px;padding:8px 10px;border:1px solid #eee;border-radius:10px;margin-top:8px;font-size:12px}
  .k{color:#444;max-width:60%}
  .v{font-weight:800;max-width:40%;text-align:right;overflow-wrap:anywhere}
  .vehicle{font-weight:900;margin-top:10px}
  @media print{ body{padding:0} .wrap{padding:18px} }
</style>
</head><body>
<div class="wrap">
  <div class="top">
    <img src="${logo}" alt="Two Little Bees">
    <div>
      <h2>TWO LITTLE BEES AUTO PARTS</h2>
      <p>(317) 243-7777 ‚Ä¢ 507 S Tibbs Ave, Indianapolis, IN</p>
    </div>
  </div>
  <hr>
  <div class="vehicle">${escapeHtml(vehicleEl.textContent || "Vehicle")}</div>
  <div>${resultsEl.innerHTML}</div>
</div>
<script>
  setTimeout(()=>{ window.print(); }, 250);
  window.onafterprint = () => { window.close(); };
<\/script>
</body></html>`;
  const w = window.open("", "_blank", "noopener,noreferrer,width=900,height=900");
  if(!w){ alert("Pop-up blocked. Allow pop-ups to print."); return; }
  w.document.open();
  w.document.write(html);
  w.document.close();
}

/* ‚úÖ Local admin edit mode (localStorage only) */
let admin = false;
const editable = document.querySelectorAll(".admin-edit");
editable.forEach(el=>{
  el.contentEditable = "false";
  el.removeAttribute("contenteditable");
});
function setAdminMode(state){
  admin = !!state;
  document.body.classList.toggle("adminMode", admin);
  editable.forEach(el=>{
    el.contentEditable = admin ? "true" : "false";
    el.style.cursor = admin ? "text" : "default";
    if(!admin) el.blur();
  });
  alert(admin ? "Admin Edit Mode ON" : "Admin Edit Mode OFF");
}
document.addEventListener("keydown", (e)=>{
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === "a"){
    setAdminMode(!admin);
  }
});
editable.forEach(el=>{
  const saved = localStorage.getItem(el.id);
  if(saved) el.innerHTML = saved;
  el.addEventListener("blur", ()=>{
    if(admin) localStorage.setItem(el.id, el.innerHTML);
  });
});
</script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import {
    getFirestore,
    collection,
    addDoc,
    deleteDoc,
    doc,
    serverTimestamp,
    query,
    orderBy,
    onSnapshot,
    setDoc,
    getDoc,
    updateDoc,
    increment,
    limit,
    where
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const NOTIFY_EMAIL = "josueblas971@gmail.com"; // email alerts destination (Trigger Email extension reads this)

  const firebaseConfig = {
    apiKey: "AIzaSyBbbBWg1x-RVuvfWfKBnOQPldMOWBLHXe8",
    authDomain: "twolittlebeeshomepage.firebaseapp.com",
    projectId: "twolittlebeeshomepage",
    storageBucket: "twolittlebeeshomepage.firebasestorage.app",
    messagingSenderId: "671040515864",
    appId: "1:671040515864:web:15b5b12775bb950709786d",
    measurementId: "G-362YBE5VQL"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // ===== UI refs
  const statViews = document.getElementById("statViews");
  const statUniqueToday = document.getElementById("statUniqueToday");

  const galleryGrid = document.getElementById("galleryGrid");
  const galleryLoading = document.getElementById("galleryLoading");
  const gPrev = document.getElementById("gPrev");
  const gNext = document.getElementById("gNext");

  const adminLoginOpen = document.getElementById("adminLoginOpen");
  const adminLogout = document.getElementById("adminLogout");
  const addPhotoOpen = document.getElementById("addPhotoOpen");

  const authPill = document.getElementById("authPill");
  const authText = document.getElementById("authText");
  const galleryHint = document.getElementById("galleryHint");

  const adminModalBackdrop = document.getElementById("adminModalBackdrop");
  const adminModal = document.getElementById("adminModal");
  const adminModalClose = document.getElementById("adminModalClose");
  const adminCancel = document.getElementById("adminCancel");
  const adminLoginDo = document.getElementById("adminLoginDo");
  const adminEmail = document.getElementById("adminEmail");
  const adminPass = document.getElementById("adminPass");
  const adminMsg = document.getElementById("adminMsg");

  const addModalBackdrop = document.getElementById("addModalBackdrop");
  const addModal = document.getElementById("addModal");
  const addModalClose = document.getElementById("addModalClose");
  const addCancel = document.getElementById("addCancel");
  const addDo = document.getElementById("addDo");
  const photoUrl = document.getElementById("photoUrl");
  const photoCaption = document.getElementById("photoCaption");
  const photoCategory = document.getElementById("photoCategory");
  const addMsg = document.getElementById("addMsg");

  const rqSubmit = document.getElementById("rqSubmit");
  const rqStatus = document.getElementById("rqStatus");
  const jcSubmit = document.getElementById("jcSubmit");
  const jcStatus = document.getElementById("jcStatus");

  const notifToggle = document.getElementById("notifToggle");
  const leadPill = document.getElementById("leadPill");
  const leadText = document.getElementById("leadText");

  const galleryCol = collection(db, "gallery");
  const leadsCol = collection(db, "leads");
  const junkCol = collection(db, "junkLeads");

  function show(el, on){ if(el) el.style.display = on ? "block" : "none"; }
  function lockScroll(on){ document.body.style.overflow = on ? "hidden" : ""; }

  // =========================
  // ‚úÖ ULTRA-LIGHT WEBSITE COUNTER
  // =========================
  function uid(){
    const k = "tlb_uid";
    let v = localStorage.getItem(k);
    if(!v){
      v = (crypto?.randomUUID ? crypto.randomUUID() : ("u_" + Math.random().toString(16).slice(2) + Date.now()));
      localStorage.setItem(k, v);
    }
    return v;
  }
  function yyyy_mm_dd(d=new Date()){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }

  const ANALYTICS_ROOT = doc(db, "analytics", "site"); // { totalViews, totalUnique, updatedAt }
  function dailyDocId(){ return "daily_" + yyyy_mm_dd(); }
  function dailyDocRef(){ return doc(db, "analyticsDaily", dailyDocId()); } // { date, views, unique, updatedAt }

  async function recordPageView(){
    // throttle: count a view max once every 30 min per browser
    const now = Date.now();
    const lastView = Number(localStorage.getItem("tlb_last_view_ts") || "0");
    if(now - lastView < 30 * 60 * 1000) return; // 30 minutes
    localStorage.setItem("tlb_last_view_ts", String(now));

    const todayKey = "tlb_seen_" + yyyy_mm_dd();
    const firstUniqueToday = !localStorage.getItem(todayKey);

    if(firstUniqueToday){
      localStorage.setItem(todayKey, "1");
    }

    // fire-and-forget style (but still awaited to avoid unhandled)
    try{
      // ensure docs exist
      await setDoc(ANALYTICS_ROOT, { totalViews: 0, totalUnique: 0, updatedAt: serverTimestamp() }, { merge:true });
      await setDoc(dailyDocRef(), { date: yyyy_mm_dd(), views: 0, unique: 0, updatedAt: serverTimestamp() }, { merge:true });

      // increments
      await updateDoc(ANALYTICS_ROOT, {
        totalViews: increment(1),
        ...(firstUniqueToday ? { totalUnique: increment(1) } : {}),
        updatedAt: serverTimestamp()
      });

      await updateDoc(dailyDocRef(), {
        views: increment(1),
        ...(firstUniqueToday ? { unique: increment(1) } : {}),
        updatedAt: serverTimestamp()
      });
    }catch(e){
      // don't spam console; counters are non-critical
      console.warn("Analytics write skipped:", e?.code || e);
    }
  }

  // Live read counters
  function safeNum(n){ return (typeof n === "number" && isFinite(n)) ? n : 0; }
  function pretty(n){
    const v = Number(n || 0);
    if(v >= 1_000_000) return (v/1_000_000).toFixed(1).replace(/\.0$/,"") + "M";
    if(v >= 1_000) return (v/1_000).toFixed(1).replace(/\.0$/,"") + "K";
    return String(v);
  }

  function attachCounterListeners(){
    onSnapshot(ANALYTICS_ROOT, (snap)=>{
      const d = snap.data() || {};
      statViews.textContent = pretty(safeNum(d.totalViews));
    }, ()=>{ /* ignore */ });

    onSnapshot(dailyDocRef(), (snap)=>{
      const d = snap.data() || {};
      statUniqueToday.textContent = pretty(safeNum(d.unique));
    }, ()=>{ /* ignore */ });
  }

  // run counters at idle to keep page snappy
  const idle = window.requestIdleCallback || ((fn)=> setTimeout(fn, 150));
  idle(()=>{ recordPageView(); attachCounterListeners(); });

  // =========================
  // MODALS
  // =========================
  function openLoginModal(){
    show(adminModalBackdrop,true);
    show(adminModal,true);
    adminMsg.textContent = "Sign in with your Firebase user (Authentication ‚Üí Users).";
    setTimeout(()=> adminEmail.focus(), 50);
    lockScroll(true);
  }
  function closeLoginModal(){
    show(adminModalBackdrop,false);
    show(adminModal,false);
    lockScroll(false);
  }

  function openAddModal(){
    show(addModalBackdrop,true);
    show(addModal,true);
    addMsg.textContent = "Paste a public direct image URL (jpg/png/webp).";
    setTimeout(()=> photoUrl.focus(), 50);
    lockScroll(true);
  }
  function closeAddModal(){
    show(addModalBackdrop,false);
    show(addModal,false);
    lockScroll(false);
  }

  adminLoginOpen.addEventListener("click", openLoginModal);
  adminModalClose.addEventListener("click", closeLoginModal);
  adminCancel.addEventListener("click", closeLoginModal);
  adminModalBackdrop.addEventListener("click", closeLoginModal);

  addPhotoOpen.addEventListener("click", openAddModal);
  addModalClose.addEventListener("click", closeAddModal);
  addCancel.addEventListener("click", closeAddModal);
  addModalBackdrop.addEventListener("click", closeAddModal);

  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      if(adminModal.style.display === "block") closeLoginModal();
      if(addModal.style.display === "block") closeAddModal();
    }
  });

  async function doLogin(){
    const email = (adminEmail.value || "").trim();
    const pass = adminPass.value || "";
    if(!email || !pass){
      adminMsg.textContent = "Enter email and password.";
      return;
    }
    adminLoginDo.disabled = true;
    adminMsg.textContent = "Signing in‚Ä¶";
    try{
      await signInWithEmailAndPassword(auth, email, pass);
      closeLoginModal();
    }catch(e){
      adminMsg.textContent = "Login failed: " + (e?.code || "") + " " + (e?.message || e);
      console.error(e);
    }finally{
      adminLoginDo.disabled = false;
    }
  }
  adminLoginDo.addEventListener("click", doLogin);
  adminPass.addEventListener("keydown", (e)=>{ if(e.key === "Enter") doLogin(); });

  adminLogout.addEventListener("click", async ()=>{
    try{ await signOut(auth); }catch(e){ console.error(e); }
  });

  function normalizeImgUrl(url){
    const u = (url || "").trim();
    if(!u) return "";
    try{
      const parsed = new URL(u);
      return parsed.toString();
    }catch{
      return "";
    }
  }

  async function addPhoto(){
    const url = normalizeImgUrl(photoUrl.value);
    const caption = (photoCaption.value || "").trim();
    const category = (photoCategory.value || "General").trim();
    if(!url){
      addMsg.textContent = "Paste a valid URL first.";
      return;
    }
    addDo.disabled = true;
    addMsg.textContent = "Adding‚Ä¶";
    try{
      await addDoc(galleryCol, { url, caption, category, createdAt: serverTimestamp() });
      photoUrl.value = "";
      photoCaption.value = "";
      photoCategory.value = "General";
      closeAddModal();
    }catch(e){
      addMsg.textContent = "Add failed: " + (e?.code || "") + " " + (e?.message || e);
      console.error(e);
    }finally{
      addDo.disabled = false;
    }
  }
  addDo.addEventListener("click", addPhoto);

  // =========================
  // GALLERY SCROLL
  // =========================
  function updateArrows(){
    const max = galleryGrid.scrollWidth - galleryGrid.clientWidth;
    if(max <= 2){ gPrev.disabled = true; gNext.disabled = true; return; }
    gPrev.disabled = galleryGrid.scrollLeft <= 2;
    gNext.disabled = galleryGrid.scrollLeft >= (max - 2);
  }
  function scrollByCard(dir){
    const card = galleryGrid.querySelector(".galleryItem");
    const step = (card ? card.getBoundingClientRect().width : 240) + 14;
    galleryGrid.scrollBy({ left: dir * step, behavior: "smooth" });
  }
  gPrev.addEventListener("click", ()=> scrollByCard(-1));
  gNext.addEventListener("click", ()=> scrollByCard(1));
  galleryGrid.addEventListener("scroll", ()=> requestAnimationFrame(updateArrows));

  // =========================
  // LIGHTBOX
  // =========================
  const lbBackdrop = document.getElementById("lightboxBackdrop");
  const lbImg = document.getElementById("lbImg");
  const lbCap = document.getElementById("lbCap");
  const lbClose = document.getElementById("lbClose");
  const lbPrev = document.getElementById("lbPrev");
  const lbNext = document.getElementById("lbNext");

  let lbItems = [];
  let lbIndex = 0;

  function openLightbox(index){
    if(!lbItems.length) return;
    lbIndex = Math.max(0, Math.min(index, lbItems.length - 1));
    renderLightbox();
    lbBackdrop.style.display = "block";
    lockScroll(true);
    lbBackdrop.setAttribute("aria-hidden","false");
  }
  function closeLightbox(){
    lbBackdrop.style.display = "none";
    lockScroll(false);
    lbBackdrop.setAttribute("aria-hidden","true");
  }
  function renderLightbox(){
    const item = lbItems[lbIndex];
    lbImg.src = item?.url || "";
    lbCap.textContent = item?.caption || "";
    const disabled = (lbItems.length <= 1);
    lbPrev.disabled = disabled;
    lbNext.disabled = disabled;
  }
  function prevLightbox(){
    if(lbItems.length <= 1) return;
    lbIndex = (lbIndex - 1 + lbItems.length) % lbItems.length;
    renderLightbox();
  }
  function nextLightbox(){
    if(lbItems.length <= 1) return;
    lbIndex = (lbIndex + 1) % lbItems.length;
    renderLightbox();
  }

  lbClose.addEventListener("click", closeLightbox);
  lbPrev.addEventListener("click", prevLightbox);
  lbNext.addEventListener("click", nextLightbox);
  lbBackdrop.addEventListener("click", (e)=>{ if(e.target === lbBackdrop) closeLightbox(); });
  document.addEventListener("keydown", (e)=>{
    if(lbBackdrop.style.display !== "block") return;
    if(e.key === "Escape") closeLightbox();
    if(e.key === "ArrowLeft") prevLightbox();
    if(e.key === "ArrowRight") nextLightbox();
  });

  // =========================
  // CATEGORY FILTER
  // =========================
  const tabs = Array.from(document.querySelectorAll("#galleryTabs .tab"));
  let activeCat = "All";
  function setActiveTab(cat){
    activeCat = cat;
    tabs.forEach(t=> t.classList.toggle("active", t.dataset.cat === cat));
    renderGallery();
  }
  tabs.forEach(t=> t.addEventListener("click", ()=> setActiveTab(t.dataset.cat || "All")));

  let snapItems = [];
  let currentUser = null;

  function addImgCard(data, isAdmin, index){
    const wrap = document.createElement("div");
    wrap.className = "galleryItem" + (isAdmin ? " admin" : "");
    wrap.style.padding = "0";

    const img = document.createElement("img");
    img.src = data.url;
    img.alt = data.caption || "Gallery photo";
    img.loading = "lazy";
    wrap.appendChild(img);

    wrap.addEventListener("click", (e)=>{
      const clickedDelete = e.target.closest(".del");
      if(clickedDelete) return;
      openLightbox(index);
    });

    const capText = (data.caption || "").trim();
    const catText = (data.category || "General").trim();

    if(capText || catText){
      const cap = document.createElement("div");
      cap.className = "cap";
      cap.textContent = capText ? capText : catText;
      wrap.appendChild(cap);
    }

    if(isAdmin && data.id){
      const del = document.createElement("button");
      del.className = "del";
      del.type = "button";
      del.textContent = "Delete";
      del.addEventListener("click", async (e)=>{
        e.stopPropagation();
        if(!confirm("Delete this photo from Firestore?")) return;
        try{ await deleteDoc(doc(db, "gallery", data.id)); }
        catch(err){ alert("Delete failed: " + (err?.message || err)); }
      });
      wrap.appendChild(del);
    }

    galleryGrid.appendChild(wrap);
  }

  function renderGallery(){
    const isAdmin = !!currentUser;
    const normalized = snapItems.map(x=>({
      ...x,
      category: (x.category || "General").trim() || "General"
    }));

    const filtered = (activeCat === "All")
      ? normalized
      : normalized.filter(x => (x.category || "General") === activeCat);

    lbItems = filtered.map(x=>({ url:x.url, caption: (x.caption || x.category || "").trim() }));

    galleryGrid.innerHTML = "";

    if(!filtered.length){
      const d = document.createElement("div");
      d.className = "galleryItem";
      d.textContent = "No photos in this category yet.";
      galleryGrid.appendChild(d);
      requestAnimationFrame(updateArrows);
      return;
    }

    filtered.forEach((item, idx)=> addImgCard(item, isAdmin, idx));
    requestAnimationFrame(updateArrows);
  }

  const q = query(galleryCol, orderBy("createdAt", "desc"));

  onSnapshot(q, (snap)=>{
    snapItems = snap.docs.map(d=> ({ id:d.id, ...d.data() })).filter(x=>x?.url);
    renderGallery();
  }, (err)=>{
    console.error(err);
    galleryGrid.innerHTML = "";
    const d = document.createElement("div");
    d.className = "galleryItem";
    d.textContent = "Gallery not loaded (check Firestore rules).";
    galleryGrid.appendChild(d);
    requestAnimationFrame(updateArrows);
  });

  // =========================
  // ‚úÖ ADMIN NOTIFICATIONS + COUNTER (new leads)
  // =========================
  function canNotify(){
    return "Notification" in window;
  }
  function notifState(){
    return localStorage.getItem("tlb_notif_on") === "1";
  }
  function setNotifState(on){
    localStorage.setItem("tlb_notif_on", on ? "1" : "0");
  }
  function updateNotifBtn(){
    if(!notifToggle) return;
    const on = notifState();
    notifToggle.textContent = on ? "üîî Alerts: ON" : "üîî Alerts: OFF";
  }
  async function requestNotifPermission(){
    if(!canNotify()) return false;
    if(Notification.permission === "granted") return true;
    if(Notification.permission === "denied") return false;
    try{
      const p = await Notification.requestPermission();
      return p === "granted";
    }catch{
      return false;
    }
  }
  function popDesktop(title, body){
    if(!canNotify()) return;
    if(Notification.permission !== "granted") return;
    try{
      new Notification(title, { body });
    }catch{
      // ignore
    }
  }

  // lead counters
  let unsubLeadWatch = null;
  let lastSeenKey = "tlb_last_seen_leads_ts";
  function getLastSeen(){ return Number(localStorage.getItem(lastSeenKey) || "0"); }
  function setLastSeen(ts){ localStorage.setItem(lastSeenKey, String(ts || Date.now())); }

  function attachLeadWatcher(){
    if(unsubLeadWatch) { unsubLeadWatch(); unsubLeadWatch = null; }
    const since = new Date(getLastSeen() || (Date.now() - 7*24*3600*1000)); // safety window
    // newest 50 leads after "since"
    const qParts = query(leadsCol, where("createdAt", ">", since), orderBy("createdAt", "desc"), limit(50));
    const qJunk  = query(junkCol,  where("createdAt", ">", since), orderBy("createdAt", "desc"), limit(50));

    let newestTs = getLastSeen();
    let partCount = 0;
    let junkCount = 0;

    const renderLeadPill = ()=>{
      const total = partCount + junkCount;
      show(leadPill, true);
      leadText.textContent = total ? `Leads: ${total} new (Parts: ${partCount}, Junk: ${junkCount})` : "Leads: 0 new";
      // pulse if new
      if(total) leadPill.classList.add("pulse"); else leadPill.classList.remove("pulse");
    };

    const u1 = onSnapshot(qParts, (snap)=>{
      partCount = snap.size;
      snap.docs.forEach(d=>{
        const t = d.data()?.createdAt?.toMillis?.() || 0;
        if(t > newestTs) newestTs = t;
      });
      renderLeadPill();
      // desktop notify (only if enabled)
      if(notifState() && snap.docChanges().some(c=>c.type === "added")){
        popDesktop("New Part Request", "A customer submitted a part request.");
      }
    }, ()=>{});

    const u2 = onSnapshot(qJunk, (snap)=>{
      junkCount = snap.size;
      snap.docs.forEach(d=>{
        const t = d.data()?.createdAt?.toMillis?.() || 0;
        if(t > newestTs) newestTs = t;
      });
      renderLeadPill();
      if(notifState() && snap.docChanges().some(c=>c.type === "added")){
        popDesktop("New Junk Car Lead", "A customer submitted a junk car lead.");
      }
    }, ()=>{});

    // mark as seen when admin clicks the pill
    leadPill.addEventListener("click", ()=>{
      if(newestTs) setLastSeen(newestTs);
      partCount = 0; junkCount = 0;
      renderLeadPill();
      showToast("Marked as seen");
    }, { once:false });

    unsubLeadWatch = ()=>{ u1(); u2(); };
  }

  notifToggle?.addEventListener("click", async ()=>{
    if(!canNotify()){
      alert("This browser doesn‚Äôt support desktop notifications.");
      return;
    }
    if(notifState()){
      setNotifState(false);
      updateNotifBtn();
      showToast("Alerts OFF");
      return;
    }
    const ok = await requestNotifPermission();
    if(!ok){
      alert("Notifications blocked. Enable them in your browser settings, then try again.");
      return;
    }
    setNotifState(true);
    updateNotifBtn();
    showToast("Alerts ON");
  });

  // =========================
  // AUTH UI
  // =========================
  onAuthStateChanged(auth, (user)=>{
    currentUser = user || null;
    const signedIn = !!user;

    adminLoginOpen.style.display = signedIn ? "none" : "inline-flex";
    adminLogout.style.display = signedIn ? "inline-flex" : "none";
    addPhotoOpen.style.display = signedIn ? "inline-flex" : "none";

    authPill.classList.toggle("ok", signedIn);
    authPill.classList.toggle("bad", !signedIn);
    authText.textContent = signedIn ? `Signed in: ${user.email || "admin"}` : "Not signed in";
    galleryHint.textContent = signedIn ? "Admin can add/delete + lead alerts" : "Public view";

    // show admin-only notifications UI
    show(notifToggle, signedIn);
    show(leadPill, signedIn);
    if(signedIn){
      updateNotifBtn();
      attachLeadWatcher();
    }else{
      if(unsubLeadWatch){ unsubLeadWatch(); unsubLeadWatch = null; }
      show(leadPill,false);
      show(notifToggle,false);
    }

    renderGallery();
    requestAnimationFrame(updateArrows);
  });

  if(galleryLoading) galleryLoading.remove();
  requestAnimationFrame(updateArrows);

  // =========================
  // EMAIL BODY HELPERS
  // =========================
  function buildEmailTextParts(payload){
    return [
      "NEW PART REQUEST",
      "----------------",
      `Name: ${payload.name || "-"}`,
      `Phone: ${payload.phone || "-"}`,
      `Vehicle: ${payload.year || "-"} ${payload.makeModel || "-"}`.trim(),
      `Part: ${payload.part || "-"}`,
      `VIN: ${payload.vin || "-"}`,
      `Photo link: ${payload.photoUrl || "-"}`,
      "",
      `Notes: ${payload.notes || "-"}`,
      "",
      "Source: Website",
      `Time: ${new Date().toLocaleString()}`
    ].join("\n");
  }

  function buildEmailTextJunk(payload){
    return [
      "NEW JUNK CAR LEAD",
      "-----------------",
      `Name: ${payload.name || "-"}`,
      `Phone: ${payload.phone || "-"}`,
      `Pickup location: ${payload.location || "-"}`,
      `Vehicle: ${payload.vehicle || "-"}`,
      `Runs: ${payload.runs || "-"}`,
      `Title: ${payload.title || "-"}`,
      "",
      `Notes: ${payload.notes || "-"}`,
      "",
      "Source: Website",
      `Time: ${new Date().toLocaleString()}`
    ].join("\n");
  }

  function setNotice(el, msg, type){
    if(!el) return;
    el.textContent = msg;
    el.className = "notice " + (type || "");
    el.style.display = "block";
  }

  function cleanPhone(p){ return String(p||"").replace(/[^\d]/g,"").slice(0, 15); }
  function cleanVin(v){ return String(v||"").toUpperCase().replace(/[^A-Z0-9]/g,"").slice(0, 17); }
  function safeTrim(s, max){
    const t = String(s||"").trim();
    return t.length > max ? t.slice(0,max) : t;
  }

  // ===== Leads: Request a Part (writes email fields for Trigger Email extension)
  async function submitRequest(){
    const payload = {
      type: "parts_request",
      name: safeTrim(document.getElementById("rqName").value, 80),
      phone: cleanPhone(document.getElementById("rqPhone").value),
      year: safeTrim(document.getElementById("rqYear").value, 10),
      makeModel: safeTrim(document.getElementById("rqMakeModel").value, 80),
      part: safeTrim(document.getElementById("rqPart").value, 80),
      vin: cleanVin(document.getElementById("rqVin").value),
      notes: safeTrim(document.getElementById("rqNotes").value, 800),
      photoUrl: normalizeImgUrl(document.getElementById("rqPhotoUrl").value) || "",
      createdAt: serverTimestamp(),
      source: "website",
      page: "home"
    };

    if(!payload.phone || (!payload.part && !(payload.year || payload.makeModel || payload.vin))){
      setNotice(rqStatus, "Please enter a phone number and at least a part or vehicle details.", "bad");
      return;
    }

    rqSubmit.disabled = true;
    setNotice(rqStatus, "Sending‚Ä¶", "");

    try{
      await addDoc(leadsCol, {
        ...payload,
        to: NOTIFY_EMAIL,
        subject: `New Part Request ‚Äî ${payload.part || "Part"} ‚Äî ${payload.phone || "No phone"}`,
        text: buildEmailTextParts(payload)
      });

      setNotice(rqStatus, "‚úÖ Sent! We‚Äôll call you soon.", "ok");

      document.getElementById("rqName").value = "";
      document.getElementById("rqPhone").value = "";
      document.getElementById("rqYear").value = "";
      document.getElementById("rqMakeModel").value = "";
      document.getElementById("rqPart").value = "";
      document.getElementById("rqVin").value = "";
      document.getElementById("rqNotes").value = "";
      document.getElementById("rqPhotoUrl").value = "";
    }catch(e){
      console.error(e);
      setNotice(rqStatus, "‚ùå Failed to send. Please try again or call us.", "bad");
    }finally{
      rqSubmit.disabled = false;
    }
  }
  if(rqSubmit) rqSubmit.addEventListener("click", submitRequest);

  // ===== Leads: Cash for Junk Cars
  async function submitJunk(){
    const payload = {
      type: "junk_car",
      name: safeTrim(document.getElementById("jcName").value, 80),
      phone: cleanPhone(document.getElementById("jcPhone").value),
      location: safeTrim(document.getElementById("jcLocation").value, 120),
      vehicle: safeTrim(document.getElementById("jcVehicle").value, 120),
      runs: safeTrim(document.getElementById("jcRuns").value, 20),
      title: safeTrim(document.getElementById("jcTitle").value, 20),
      notes: safeTrim(document.getElementById("jcNotes").value, 800),
      createdAt: serverTimestamp(),
      source: "website",
      page: "home"
    };

    if(!payload.phone || !payload.vehicle || !payload.location){
      setNotice(jcStatus, "Please enter phone + pickup location + vehicle info.", "bad");
      return;
    }

    jcSubmit.disabled = true;
    setNotice(jcStatus, "Sending‚Ä¶", "");

    try{
      await addDoc(junkCol, {
        ...payload,
        to: NOTIFY_EMAIL,
        subject: `New Junk Car Lead ‚Äî ${payload.vehicle || "Vehicle"} ‚Äî ${payload.phone || "No phone"}`,
        text: buildEmailTextJunk(payload)
      });

      setNotice(jcStatus, "‚úÖ Sent! We‚Äôll call you with an offer.", "ok");

      document.getElementById("jcName").value = "";
      document.getElementById("jcPhone").value = "";
      document.getElementById("jcLocation").value = "";
      document.getElementById("jcVehicle").value = "";
      document.getElementById("jcRuns").value = "";
      document.getElementById("jcTitle").value = "";
      document.getElementById("jcNotes").value = "";
    }catch(e){
      console.error(e);
      setNotice(jcStatus, "‚ùå Failed to send. Please try again or call us.", "bad");
    }finally{
      jcSubmit.disabled = false;
    }
  }
  if(jcSubmit) jcSubmit.addEventListener("click", submitJunk);
</script>

</body>
</html>
