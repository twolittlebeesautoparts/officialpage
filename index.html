<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>Two Little Bees Auto Parts</title>

<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#0b0f14">
<meta name="description" content="Two Little Bees Auto Parts ‚Äî VIN-verified OEM used parts in Indianapolis. Engines, transmissions, modules, and more.">
<link rel="preconnect" href="https://vpic.nhtsa.dot.gov">
<link rel="preconnect" href="https://github.com">

<style>
:root{
  --bg:#0b0f14;
  --panel:#111827;
  --panel-soft:#0f172a;

  --accent:#f4c430;
  --accent2:#ffb703;

  --text:#f9fafb;
  --muted:#9ca3af;

  --border:rgba(255,255,255,.10);
  --border2:rgba(255,255,255,.14);
  --shadow:0 30px 60px rgba(0,0,0,.55);

  --radius:18px;
  --radius2:14px;

  --ok:#22c55e;
  --bad:#ef4444;
  --warn:#f59e0b;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{width:100%;max-width:100%;overflow-x:hidden}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:
    radial-gradient(900px 500px at 15% -10%, rgba(244,196,48,.14), transparent 60%),
    radial-gradient(900px 500px at 90% 10%, rgba(255,183,3,.10), transparent 60%),
    var(--bg);
  color:var(--text);
  padding-left:env(safe-area-inset-left);
  padding-right:env(safe-area-inset-right);
  padding-top:env(safe-area-inset-top);
  padding-bottom:calc(env(safe-area-inset-bottom) + 18px);
  -webkit-font-smoothing:antialiased;
}

/* ====== Header ====== */
header{
  position:sticky;
  top:0;
  z-index:100;
  background:rgba(11,15,20,.90);
  backdrop-filter:blur(10px);
  border-bottom:1px solid rgba(255,255,255,.08);
}

.header-inner{
  max-width:1200px;
  margin:auto;
  padding:12px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  flex-wrap:wrap;
}

.logo{
  display:flex;
  align-items:center;
  gap:12px;
  font-weight:950;
  white-space:nowrap;
}

.logo img{
  height:58px;
  width:auto;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.10);
  box-shadow:0 14px 28px rgba(0,0,0,.28);
  background:#0f172a;
}

.logo span{
  font-size:1rem;
  letter-spacing:.2px;
}

nav{display:flex;gap:8px;align-items:center}

nav a{
  text-decoration:none;
  font-weight:900;
  padding:8px 14px;
  border-radius:999px;
  color:var(--muted);
  border:1px solid rgba(255,255,255,.12);
  font-size:.85rem;
  transition:transform .12s ease, filter .12s ease, opacity .12s ease;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
}

nav a:hover{filter:brightness(1.05)}
nav a:active{transform:scale(.99)}

nav a.cta{
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#000;
  border:none;
}

nav a.vin-btn{
  background:#0f172a;
  color:#fff;
}

/* ====== Main Layout ====== */
main{display:block}

.hero{
  max-width:1200px;
  margin:auto;
  padding:44px 16px 22px;
  display:grid;
  grid-template-columns:1.05fr .95fr;
  gap:28px;
  align-items:start;
}

.hero h1{
  font-size:clamp(2.0rem,4.6vw,3.1rem);
  line-height:1.05;
  letter-spacing:-.6px;
}
.hero p{
  color:var(--muted);
  max-width:560px;
  margin:14px 0 18px;
  font-size:1rem;
  line-height:1.5;
}

.badges{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin:14px 0 6px;
}

.badge{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(15,23,42,.55);
  color:var(--text);
  font-weight:900;
  font-size:.85rem;
}
.badge .dot{
  width:8px;height:8px;border-radius:999px;background:var(--accent);
  box-shadow:0 0 0 3px rgba(244,196,48,.15);
}

.btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  padding:14px 18px;
  border-radius:14px;
  font-weight:950;
  text-decoration:none;
  user-select:none;
  -webkit-tap-highlight-color: transparent;
  transition:transform .12s ease, filter .12s ease;
}
.btn:active{transform:scale(.99)}
.btn.primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#000;border:none}
.btn.secondary{border:1px solid rgba(255,255,255,.18);color:var(--text);background:rgba(0,0,0,.12)}

.card{
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)), var(--panel);
  border:1px solid rgba(255,255,255,.14);
  border-radius:var(--radius);
  padding:20px;
  box-shadow:var(--shadow);
}

.card h3{
  font-size:1.05rem;
  letter-spacing:.2px;
}

.sell-grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:14px;
}

.sell-item{
  display:flex;
  align-items:center;
  gap:10px;
  background:rgba(15,23,42,.75);
  border:1px solid rgba(255,255,255,.12);
  border-radius:14px;
  padding:12px;
  color:var(--muted);
  font-weight:850;
  font-size:.92rem;
}

.sell-item span{
  width:22px;height:22px;border-radius:50%;
  display:grid;place-items:center;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:#000;font-size:.72rem;
  flex:0 0 auto;
}

.stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
  margin-top:20px;
}

.stat{
  background:rgba(15,23,42,.75);
  border:1px solid rgba(255,255,255,.12);
  border-radius:16px;
  padding:14px;
  text-align:center;
}

.stat h3{color:var(--accent);font-size:1.2rem}
.stat span{color:var(--muted);font-size:.86rem}

/* Sections */
.section{
  max-width:1200px;
  margin:auto;
  padding:22px 16px;
}
.section .card{padding:22px}
.sectionTitleRow{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:10px;
}
.sectionTitleRow small{color:var(--muted);font-weight:800}

.admin-edit[contenteditable="true"]{
  outline:2px dashed rgba(244,196,48,.75);
  outline-offset:6px;
  border-radius:14px;
  padding:10px;
}

/* Gallery grid */
#galleryGrid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
  gap:12px;
}
.galleryItem{
  border-radius:16px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(15,23,42,.65);
  overflow:hidden;
  min-height:120px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:var(--muted);
  font-weight:900;
  position:relative;
}
.galleryItem img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.galleryItem .cap{
  position:absolute;
  left:10px; right:10px; bottom:10px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.14);
  padding:8px 10px;
  border-radius:12px;
  color:#fff;
  font-size:.78rem;
  font-weight:900;
  display:none;
}
.galleryItem:hover .cap{display:block}
.galleryItem .del{
  position:absolute;
  top:10px; right:10px;
  background:rgba(0,0,0,.55);
  border:1px solid rgba(255,255,255,.18);
  color:#fff;
  border-radius:12px;
  padding:8px 10px;
  font-weight:950;
  cursor:pointer;
  display:none;
}
.galleryItem.admin .del{display:block}

/* Admin bar */
#adminBar{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  margin-bottom:12px;
}
#adminBar .left{
  display:flex;flex-wrap:wrap;gap:10px;align-items:center;
}
.pill{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:8px 12px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(15,23,42,.55);
  color:var(--text);
  font-weight:900;
  font-size:.85rem;
}
.pill .tinyDot{
  width:8px;height:8px;border-radius:999px;background:rgba(255,255,255,.25);
  box-shadow:0 0 0 3px rgba(255,255,255,.08);
}
.pill.ok .tinyDot{background:var(--ok);box-shadow:0 0 0 3px rgba(34,197,94,.18)}
.pill.bad .tinyDot{background:var(--bad);box-shadow:0 0 0 3px rgba(239,68,68,.18)}

/* Footer */
footer{
  border-top:1px solid rgba(255,255,255,.08);
  padding:22px 16px;
  display:grid;
  gap:10px;
  max-width:1200px;
  margin:0 auto;
}
footer span{color:var(--muted);font-size:.92rem;line-height:1.35}
.footerRow{
  display:flex;
  flex-wrap:wrap;
  justify-content:space-between;
  gap:12px;
  align-items:flex-start;
}
.footerLinks{
  display:flex;flex-wrap:wrap;gap:10px;
}
.footerLinks a{
  color:var(--text);
  text-decoration:none;
  border:1px solid rgba(255,255,255,.12);
  padding:8px 12px;
  border-radius:999px;
  font-weight:900;
  font-size:.85rem;
}

/* ====== VIN Panel (Bottom Sheet) ====== */
#vin-panel-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  z-index:997;
}

#vin-panel{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:18px;
  width:360px;
  max-height:82vh;
  background:#0b1210;
  border-radius:18px;
  padding:14px;
  display:none;
  box-shadow:0 30px 60px rgba(0,0,0,.75);
  z-index:998;
  border:1px solid rgba(255,255,255,.12);
}

#vin-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
#vin-head strong{font-size:.95rem}
#vin-close{
  border:1px solid rgba(255,255,255,.18);
  background:#0f1714;
  color:#fff;
  border-radius:12px;
  padding:8px 10px;
  font-weight:950;
  cursor:pointer;
}

#vin-meta{
  color:#aeb8c2;
  font-size:.82rem;
  margin-bottom:10px;
  line-height:1.3;
}

#vin-panel input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#0c1612;
  color:#fff;
  text-transform:uppercase;
  letter-spacing:.6px;
}

#vin-actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-top:8px;
}

#vin-panel button{
  width:100%;
  margin-top:0;
  padding:11px;
  border-radius:12px;
  border:none;
  font-weight:950;
  cursor:pointer;
}

#vin-status{
  margin-top:10px;
  font-size:12px;
  min-height:18px;
  color:#9bb0a6;
  display:flex;
  align-items:center;
  gap:8px;
}

.dot{
  width:8px;height:8px;border-radius:50%;
  background:rgba(255,255,255,.18);
  box-shadow:0 0 0 3px rgba(255,255,255,.06);
}
#vin-status.ok{color:var(--ok)}
#vin-status.ok .dot{background:var(--ok);box-shadow:0 0 0 3px rgba(34,197,94,.18)}
#vin-status.bad{color:var(--bad)}
#vin-status.bad .dot{background:var(--bad);box-shadow:0 0 0 3px rgba(239,68,68,.18)}
#vin-status.warn{color:var(--warn)}
#vin-status.warn .dot{background:var(--warn);box-shadow:0 0 0 3px rgba(245,158,11,.18)}

#vin-panel #results{
  max-height:38vh;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  margin-top:10px;
  padding-right:2px;
}

.row{
  display:flex;
  justify-content:space-between;
  gap:12px;
  background:#0f1714;
  padding:9px 10px;
  border-radius:12px;
  margin-top:8px;
  font-size:12px;
  border:1px solid rgba(255,255,255,.08);
  cursor:pointer;
}
.k{color:#9bb0a6;max-width:60%}
.v{font-weight:950;text-align:right;max-width:40%;overflow-wrap:anywhere}
.vehicle{text-align:center;font-weight:950;margin-top:10px}

.toast{
  position:fixed;
  left:50%;
  transform:translateX(-50%);
  bottom:calc(env(safe-area-inset-bottom) + 14px);
  background:rgba(15,23,42,.92);
  border:1px solid rgba(255,255,255,.12);
  padding:10px 12px;
  border-radius:12px;
  font-size:12px;
  color:var(--text);
  display:none;
  z-index:9999;
  box-shadow:0 20px 40px rgba(0,0,0,.45);
}

/* ====== Admin Login Modal ====== */
#adminModalBackdrop{
  position:fixed; inset:0;
  background:rgba(0,0,0,.62);
  display:none;
  z-index:2000;
}
#adminModal{
  position:fixed;
  left:50%; top:50%;
  transform:translate(-50%,-50%);
  width:min(460px, calc(100% - 24px));
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)), var(--panel);
  border:1px solid rgba(255,255,255,.14);
  border-radius:18px;
  box-shadow:0 30px 80px rgba(0,0,0,.7);
  padding:16px;
  display:none;
  z-index:2001;
}
.modalHead{
  display:flex;align-items:center;justify-content:space-between;gap:10px;
  margin-bottom:10px;
}
.modalHead strong{font-size:1rem}
.iconBtn{
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.12);
  color:#fff;
  border-radius:12px;
  padding:8px 10px;
  font-weight:950;
  cursor:pointer;
}
.field{margin-top:10px;}
.field label{
  display:block;
  font-size:.85rem;
  color:var(--muted);
  font-weight:900;
  margin-bottom:6px;
}
.field input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.15);
  background:#0c121a;
  color:#fff;
  font-weight:800;
}
.modalActions{display:flex;gap:10px;margin-top:12px;}
.modalActions button{flex:1}
.helper{
  margin-top:10px;
  color:var(--muted);
  font-size:.85rem;
  line-height:1.35;
}

/* Mobile */
@media(max-width:900px){ .hero{grid-template-columns:1fr} }
@media(max-width:600px){
  .stats,.sell-grid{grid-template-columns:1fr}
  nav{
    width:100%;
    justify-content:center;
    overflow-x:auto;
    padding-top:8px;
  }
  nav a{flex-shrink:0}
  #vin-panel{
    left:0; right:0;
    bottom:env(safe-area-inset-bottom);
    width:100%;
    max-height:78vh;
    transform:none;
    border-radius:18px 18px 0 0;
  }
}
</style>
</head>

<body>
<div class="toast" id="toast">Copied</div>

<header>
  <div class="header-inner">
    <div class="logo">
      <img alt="Two Little Bees Auto Parts"
           src="https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/logo.png?raw=true">
      <span>Two Little Bees Auto Parts</span>
    </div>

    <nav>
      <a href="#top">Home</a>
      <a class="cta" href="https://twolittlebeesautoparts.github.io/OFFICIALPAGE/">Inventory</a>
      <a href="javascript:void(0)" class="vin-btn" onclick="toggleVin()">VIN</a>
    </nav>
  </div>
</header>

<main id="top">
  <section class="hero">
    <div>
      <h1>The Right Parts.<br>Every Time.<br>Built on Trust.</h1>

      <div class="badges">
        <div class="badge"><span class="dot"></span> Established in Indianapolis</div>
        <div class="badge"><span class="dot"></span> VIN-Verified</div>
        <div class="badge"><span class="dot"></span> Fast Counter Support</div>
      </div>

      <p>Live inventory tied to real vehicles. Call or search ‚Äî we move fast, verify fitment, and keep it simple.</p>

      <div class="btns">
        <a class="btn primary" href="https://twolittlebeesautoparts.github.io/">Search Inventory</a>
        <a class="btn secondary" href="tel:3172437777">Call (317) 243-7777</a>
        <a class="btn secondary" href="https://www.google.com/maps?q=507+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener">Get Directions</a>
      </div>

      <div class="stats">
        <div class="stat"><h3>10K+</h3><span>OEM Parts</span></div>
        <div class="stat"><h3>1985‚Äì2026</h3><span>Coverage</span></div>
        <div class="stat"><h3>Trusted</h3><span>Local Professionals</span></div>
      </div>
    </div>

    <div class="card">
      <h3>What We Sell</h3>
      <div class="sell-grid">
        <div class="sell-item"><span>‚úì</span> Engines & Transmissions</div>
        <div class="sell-item"><span>‚úì</span> Suspension & Drivetrain</div>
        <div class="sell-item"><span>‚úì</span> Body & Interior</div>
        <div class="sell-item"><span>‚úì</span> Electrical Modules</div>
        <div class="sell-item"><span>‚úì</span> OEM Used Parts</div>
        <div class="sell-item"><span>‚úì</span> VIN-Verified Fitment</div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="card">
      <div class="sectionTitleRow">
        <h3>About Us</h3>
        <small>Ctrl + Shift + A to edit</small>
      </div>

      <div id="aboutText" class="admin-edit">
        Two Little Bees Auto Parts is a locally owned auto parts business based in Indianapolis, focused on providing quality OEM used parts pulled from real vehicles.
        <br><br>
        We specialize in VIN-verified parts, making sure every engine, transmission, module, or body component is correctly matched before it ever leaves our yard.
        That means fewer mistakes, no guesswork, and confidence that the part you‚Äôre buying is the right one.
        <br><br>
        Serving local repair shops, dealerships, and walk-in customers, we cover vehicles from 1985‚Äì2026 and maintain live inventory tied directly to the cars we dismantle.
        When you call, you talk to someone who knows parts.
        <br><br>
        Built in Indianapolis and grounded in trust ‚Äî accurate parts, straight answers, no wasted time.
      </div>
    </div>
  </section>

  <section class="section" style="padding-top:0">
    <div class="card">
      <div class="sectionTitleRow">
        <h3>Gallery</h3>
        <small id="galleryHint">Firestore Gallery (free)</small>
      </div>

      <!-- Admin bar -->
      <div id="adminBar">
        <div class="left">
          <button class="btn secondary" id="adminLoginOpen" type="button">Admin Login</button>
          <button class="btn secondary" id="adminLogout" type="button" style="display:none">Logout</button>
          <button class="btn primary" id="addPhotoOpen" type="button" style="display:none">Add Photo</button>
        </div>

        <div class="pill bad" id="authPill">
          <span class="tinyDot"></span>
          <span id="authText">Not signed in</span>
        </div>
      </div>

      <div id="galleryGrid">
        <div class="galleryItem" id="galleryLoading">Loading gallery‚Ä¶</div>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="footerRow">
    <span>¬© 2026 Two Little Bees Auto Parts</span>
    <span>
      üìû <a href="tel:3172437777" style="color:inherit;text-decoration:none">(317) 243-7777</a><br>
      üìç <a href="https://www.google.com/maps?q=507+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener" style="color:inherit;text-decoration:none">507 S Tibbs Ave, Indianapolis</a>
    </span>
  </div>

  <div class="footerLinks">
    <a href="https://twolittlebeesautoparts.github.io/">Inventory</a>
    <a href="javascript:void(0)" onclick="toggleVin()">VIN Decoder</a>
    <a href="tel:3172437777">Call</a>
    <a href="https://www.google.com/maps?q=507+S+Tibbs+Ave,+Indianapolis,+IN" target="_blank" rel="noopener">Directions</a>
  </div>
</footer>

<!-- Backdrop for VIN panel -->
<div id="vin-panel-backdrop" onclick="toggleVin()"></div>

<!-- VIN bottom sheet -->
<div id="vin-panel" role="dialog" aria-modal="true" aria-label="VIN Decoder">
  <div id="vin-head">
    <strong>VIN Decoder</strong>
    <button id="vin-close" onclick="toggleVin()">Close</button>
  </div>

  <div id="vin-meta">
    Two Little Bees Auto Parts ‚Ä¢ (317) 243-7777 ‚Ä¢ Indianapolis
  </div>

  <input id="vin" maxlength="17" placeholder="ENTER 17-CHAR VIN" autocomplete="off" />

  <div id="vin-actions">
    <button class="primary" onclick="decode()">Decode VIN</button>
    <button class="secondary" onclick="printSheet()">Print VIN Sheet</button>
  </div>

  <div id="vin-status"><span class="dot"></span><span id="vin-status-text"></span></div>
  <div id="vehicle" class="vehicle"></div>
  <div id="results"></div>
</div>

<!-- Print sheet (only used for printing, does not display on page) -->
<div id="print-sheet" style="display:none"></div>

<!-- Admin Login Modal -->
<div id="adminModalBackdrop"></div>
<div id="adminModal" role="dialog" aria-modal="true" aria-label="Admin Login">
  <div class="modalHead">
    <strong>Admin Login</strong>
    <button class="iconBtn" id="adminModalClose" type="button">Close</button>
  </div>

  <div class="field">
    <label for="adminEmail">Email</label>
    <input id="adminEmail" type="email" placeholder="your admin email" autocomplete="username">
  </div>

  <div class="field">
    <label for="adminPass">Password</label>
    <input id="adminPass" type="password" placeholder="your password" autocomplete="current-password">
  </div>

  <div class="modalActions">
    <button class="btn secondary" id="adminCancel" type="button">Cancel</button>
    <button class="btn primary" id="adminLoginDo" type="button">Login</button>
  </div>

  <div class="helper" id="adminMsg">
    Sign in using your Firebase user (Authentication ‚Üí Users).
  </div>
</div>

<!-- Add Photo Modal -->
<div id="addModalBackdrop" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.62);z-index:2100"></div>
<div id="addModal" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(520px,calc(100% - 24px));background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)), var(--panel);border:1px solid rgba(255,255,255,.14);border-radius:18px;box-shadow:0 30px 80px rgba(0,0,0,.7);padding:16px;z-index:2101">
  <div class="modalHead">
    <strong>Add Gallery Photo</strong>
    <button class="iconBtn" id="addModalClose" type="button">Close</button>
  </div>

  <div class="field">
    <label for="photoUrl">Photo URL (public link)</label>
    <input id="photoUrl" type="url" placeholder="https://..." autocomplete="off">
  </div>
  <div class="field">
    <label for="photoCaption">Caption (optional)</label>
    <input id="photoCaption" type="text" placeholder="Engine arrivals, shop, yard, etc." autocomplete="off">
  </div>

  <div class="modalActions">
    <button class="btn secondary" id="addCancel" type="button">Cancel</button>
    <button class="btn primary" id="addDo" type="button">Add</button>
  </div>

  <div class="helper" id="addMsg">
    Tip: Google Drive must be shared as ‚ÄúAnyone with link can view‚Äù and use a direct viewable link.
  </div>
</div>

<script>
/* ======================
   YOUR EXISTING VIN + LOCAL EDIT MODE
====================== */

/* ===== VIN PANEL STATE ===== */
const vinPanel = document.getElementById("vin-panel");
const vinBackdrop = document.getElementById("vin-panel-backdrop");
const vinInput = document.getElementById("vin");
const resultsEl = document.getElementById("results");
const vehicleEl = document.getElementById("vehicle");

const vinStatus = document.getElementById("vin-status");
const vinStatusText = document.getElementById("vin-status-text");
const toast = document.getElementById("toast");

let vinBusy = false;
let lastVinCache = { vin:"", d:null, ts:0 };

function setVinStatus(msg, type=""){
  vinStatusText.textContent = msg || "";
  vinStatus.className = type ? type : "";
  vinStatus.id = "vin-status";
}

function toggleVin(force){
  const isOpen = vinPanel.style.display === "block";
  const next = (force === undefined) ? !isOpen : !!force;

  vinPanel.style.display = next ? "block" : "none";
  vinBackdrop.style.display = next ? "block" : "none";

  if(next){
    setTimeout(()=> vinInput.focus(), 60);
    document.body.style.overflow = "hidden";
  }else{
    document.body.style.overflow = "";
  }
}

document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape"){
    if(vinPanel.style.display === "block") toggleVin(false);
  }
});

function cleanVIN(v){ return (v||"").toUpperCase().replace(/[^A-Z0-9]/g,""); }
function validVIN(v){ return v.length === 17 && !/[IOQ]/.test(v); }

vinInput.addEventListener("input", ()=>{
  const c = cleanVIN(vinInput.value);
  if(vinInput.value !== c) vinInput.value = c;
  if(c.length === 17 && validVIN(c)) setVinStatus("Ready to decode.", "");
  else if(c.length) setVinStatus("Enter 17 chars (no I/O/Q).", "warn");
  else setVinStatus("", "");
});

vinInput.addEventListener("keydown", (e)=>{
  if(e.key === "Enter"){ e.preventDefault(); decode(); }
});

async function fetchDecode(v){
  const direct = `https://vpic.nhtsa.dot.gov/api/vehicles/DecodeVinValuesExtended/${v}?format=json`;
  try{
    const r1 = await fetch(direct, { cache:"no-store" });
    if(!r1.ok) throw new Error("Direct failed");
    return await r1.json();
  }catch{
    const proxy = "https://api.allorigins.win/raw?url=" + encodeURIComponent(direct);
    const r2 = await fetch(proxy, { cache:"no-store" });
    return await r2.json();
  }
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, (m)=>({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"
  }[m]));
}

function row(k, v){
  if(!v || v === "Not Applicable") return;
  const safeK = escapeHtml(k);
  const safeV = escapeHtml(v);
  resultsEl.insertAdjacentHTML("beforeend", `
    <div class="row" data-copy="${safeV}">
      <div class="k">${safeK}</div>
      <div class="v">${safeV}</div>
    </div>
  `);
}

function showToast(msg){
  toast.textContent = msg;
  toast.style.display = "block";
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=> toast.style.display="none", 900);
}

document.addEventListener("click", async (e)=>{
  const r = e.target.closest("#results .row");
  if(!r) return;
  const text = r.getAttribute("data-copy");
  if(!text) return;

  try{
    await navigator.clipboard.writeText(text);
    showToast("Copied");
  }catch{
    const ta = document.createElement("textarea");
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    showToast("Copied");
  }
});

async function decode(){
  let v = cleanVIN(vinInput.value);
  vinInput.value = v;

  if(!validVIN(v)){
    setVinStatus("Invalid VIN. Must be 17 chars and no I/O/Q.", "bad");
    return;
  }
  if(vinBusy) return;
  vinBusy = true;

  const now = Date.now();
  if(lastVinCache.vin === v && lastVinCache.d && (now - lastVinCache.ts) < 60_000){
    renderVin(lastVinCache.d, v);
    setVinStatus("Loaded from cache.", "ok");
    vinBusy = false;
    return;
  }

  setVinStatus("Decoding VIN‚Ä¶", "warn");
  resultsEl.innerHTML = "";
  vehicleEl.textContent = "Decoding‚Ä¶";

  try{
    const json = await fetchDecode(v);
    const d = json?.Results?.[0] || {};
    lastVinCache = { vin:v, d, ts:Date.now() };
    renderVin(d, v);
    setVinStatus("VIN decoded successfully.", "ok");
  }catch{
    vehicleEl.textContent = "Decode failed.";
    setVinStatus("Decode failed. Check internet and try again.", "bad");
  }
  vinBusy = false;
}

function renderVin(d, v){
  const line = `${d.ModelYear || ""} ${d.Make || ""} ${d.Model || ""}`.trim() || "Vehicle";
  vehicleEl.textContent = line;

  row("VIN", v);
  row("Year", d.ModelYear);
  row("Make", d.Make);
  row("Model", d.Model);
  row("Trim", d.Trim);

  row("Engine", d.EngineModel || (d.DisplacementL ? `${d.DisplacementL}L` : ""));
  row("Displacement", d.DisplacementL ? `${d.DisplacementL} L` : "");
  row("Cylinders", d.EngineCylinders);
  row("Fuel", d.FuelTypePrimary);

  row("Transmission", d.TransmissionStyle);
  row("Trans Speeds", d.TransmissionSpeeds);
  row("Drive", d.DriveType);

  row("Body", d.BodyClass);
  row("Doors", d.Doors);
  row("Vehicle Type", d.VehicleType);
  row("GVWR", d.GVWR);
}

function printSheet(){
  const ps = document.getElementById("print-sheet");
  ps.innerHTML = `
    <div style="background:#fff;color:#000;padding:20px;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif">
      <img src="https://github.com/twolittlebeesautoparts/OFFICIALPAGE/blob/main/logo.png?raw=true" alt="Two Little Bees" style="height:60px">
      <h2 style="margin:10px 0 6px">TWO LITTLE BEES AUTO PARTS</h2>
      <p>(317) 243-7777 ‚Ä¢ Indianapolis</p>
      <p style="margin-top:6px">507 S Tibbs Ave, Indianapolis, IN</p>
      <hr style="margin:12px 0">
      <div style="font-weight:900">${escapeHtml(vehicleEl.innerText)}</div>
      <div>${resultsEl.innerHTML}</div>
    </div>
  `;
  const prev = document.body.innerHTML;
  const keep = ps.outerHTML;
  document.body.innerHTML = keep;
  window.print();
  location.reload();
}

/* ===== LOCAL ADMIN EDIT MODE (localStorage only) ===== */
let admin = false;
const adminBtn = document.getElementById("adminToggle");
const editable = document.querySelectorAll(".admin-edit");

document.addEventListener("keydown", (e)=>{
  if(e.ctrlKey && e.shiftKey && e.key.toLowerCase() === "a"){
    admin = !admin;
    if(adminBtn) adminBtn.style.display = admin ? "block" : "none";

    editable.forEach(el=>{
      el.contentEditable = admin;
      el.style.cursor = admin ? "text" : "default";
    });

    alert(admin ? "Admin Edit Mode ON" : "Admin Edit Mode OFF");
  }
});

editable.forEach(el=>{
  const saved = localStorage.getItem(el.id);
  if(saved) el.innerHTML = saved;

  el.addEventListener("blur", ()=>{
    if(admin){
      localStorage.setItem(el.id, el.innerHTML);
    }
  });
});
</script>

<!-- Your existing admin toggle pill -->
<button id="adminToggle" style="
  position:fixed;
  bottom:16px;
  right:16px;
  z-index:999;
  padding:10px 14px;
  border-radius:999px;
  font-weight:950;
  border:none;
  background:linear-gradient(135deg,#f4c430,#ffb703);
  color:#000;
  display:none;
  box-shadow:0 18px 35px rgba(0,0,0,.4);
  cursor:pointer;
">
  ADMIN
</button>

<!-- Firebase Firestore Gallery (FREE: links stored in Firestore) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import { getFirestore, collection, addDoc, deleteDoc, doc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // ‚úÖ YOUR REAL CONFIG (from your Firebase console)
  const firebaseConfig = {
    apiKey: "AIzaSyCsgPuGyKnzoZtjBofZ_wdApnr4bVjpio",
    authDomain: "twolittlebeeshomepage.firebaseapp.com",
    projectId: "twolittlebeeshomepage",
    storageBucket: "twolittlebeeshomepage.firebasestorage.app",
    messagingSenderId: "671040515864",
    appId: "1:671040515864:web:15b5b12775bb950709786d",
    measurementId: "G-362YBE5VQL"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // UI
  const galleryGrid = document.getElementById("galleryGrid");
  const galleryLoading = document.getElementById("galleryLoading");

  const adminLoginOpen = document.getElementById("adminLoginOpen");
  const adminLogout = document.getElementById("adminLogout");
  const addPhotoOpen = document.getElementById("addPhotoOpen");

  const authPill = document.getElementById("authPill");
  const authText = document.getElementById("authText");
  const galleryHint = document.getElementById("galleryHint");

  // Login modal
  const adminModalBackdrop = document.getElementById("adminModalBackdrop");
  const adminModal = document.getElementById("adminModal");
  const adminModalClose = document.getElementById("adminModalClose");
  const adminCancel = document.getElementById("adminCancel");
  const adminLoginDo = document.getElementById("adminLoginDo");
  const adminEmail = document.getElementById("adminEmail");
  const adminPass = document.getElementById("adminPass");
  const adminMsg = document.getElementById("adminMsg");

  // Add modal
  const addModalBackdrop = document.getElementById("addModalBackdrop");
  const addModal = document.getElementById("addModal");
  const addModalClose = document.getElementById("addModalClose");
  const addCancel = document.getElementById("addCancel");
  const addDo = document.getElementById("addDo");
  const photoUrl = document.getElementById("photoUrl");
  const photoCaption = document.getElementById("photoCaption");
  const addMsg = document.getElementById("addMsg");

  const galleryCol = collection(db, "gallery");

  function openLoginModal(){
    adminModalBackdrop.style.display = "block";
    adminModal.style.display = "block";
    adminMsg.textContent = "Sign in with your Firebase user (Authentication ‚Üí Users).";
    setTimeout(()=> adminEmail.focus(), 50);
    document.body.style.overflow = "hidden";
  }
  function closeLoginModal(){
    adminModalBackdrop.style.display = "none";
    adminModal.style.display = "none";
    document.body.style.overflow = "";
  }

  function openAddModal(){
    addModalBackdrop.style.display = "block";
    addModal.style.display = "block";
    addMsg.textContent = "Paste a public image URL. (Google Drive must be public.)";
    setTimeout(()=> photoUrl.focus(), 50);
    document.body.style.overflow = "hidden";
  }
  function closeAddModal(){
    addModalBackdrop.style.display = "none";
    addModal.style.display = "none";
    document.body.style.overflow = "";
  }

  adminLoginOpen.addEventListener("click", openLoginModal);
  adminModalClose.addEventListener("click", closeLoginModal);
  adminCancel.addEventListener("click", closeLoginModal);
  adminModalBackdrop.addEventListener("click", closeLoginModal);

  addPhotoOpen.addEventListener("click", openAddModal);
  addModalClose.addEventListener("click", closeAddModal);
  addCancel.addEventListener("click", closeAddModal);
  addModalBackdrop.addEventListener("click", closeAddModal);

  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape"){
      if(adminModal.style.display === "block") closeLoginModal();
      if(addModal.style.display === "block") closeAddModal();
    }
  });

  async function doLogin(){
    const email = (adminEmail.value || "").trim();
    const pass = adminPass.value || "";
    if(!email || !pass){
      adminMsg.textContent = "Enter email and password.";
      return;
    }
    adminLoginDo.disabled = true;
    adminMsg.textContent = "Signing in‚Ä¶";
    try{
      await signInWithEmailAndPassword(auth, email, pass);
      closeLoginModal();
    }catch(e){
      adminMsg.textContent = "Login failed: " + (e?.message || e);
    }finally{
      adminLoginDo.disabled = false;
    }
  }

  adminLoginDo.addEventListener("click", doLogin);
  adminPass.addEventListener("keydown", (e)=>{ if(e.key === "Enter") doLogin(); });

  adminLogout.addEventListener("click", async ()=>{
    try{ await signOut(auth); }catch{}
  });

  function makeEmpty(msg){
    galleryGrid.innerHTML = "";
    const d = document.createElement("div");
    d.className = "galleryItem";
    d.textContent = msg;
    galleryGrid.appendChild(d);
  }

  function addImgCard(data, isAdmin){
    const wrap = document.createElement("div");
    wrap.className = "galleryItem" + (isAdmin ? " admin" : "");
    wrap.style.padding = "0";

    const img = document.createElement("img");
    img.src = data.url;
    img.alt = data.caption || "Gallery photo";
    img.loading = "lazy";

    wrap.appendChild(img);

    if(data.caption){
      const cap = document.createElement("div");
      cap.className = "cap";
      cap.textContent = data.caption;
      wrap.appendChild(cap);
    }

    if(isAdmin && data.id){
      const del = document.createElement("button");
      del.className = "del";
      del.type = "button";
      del.textContent = "Delete";
      del.addEventListener("click", async (e)=>{
        e.stopPropagation();
        if(!confirm("Delete this photo from Firestore?")) return;
        try{
          await deleteDoc(doc(db, "gallery", data.id));
        }catch(err){
          alert("Delete failed: " + (err?.message || err));
        }
      });
      wrap.appendChild(del);
    }

    galleryGrid.appendChild(wrap);
  }

  function isLikelyImageUrl(u){
    const s = (u || "").toLowerCase();
    return s.startsWith("http") && (s.includes("googleusercontent") || s.match(/\.(jpg|jpeg|png|webp|gif)(\?|#|$)/));
  }

  async function addPhoto(){
    const url = (photoUrl.value || "").trim();
    const caption = (photoCaption.value || "").trim();

    if(!url){
      addMsg.textContent = "Paste a photo URL first.";
      return;
    }

    // Soft warning, still allow.
    if(!isLikelyImageUrl(url)){
      addMsg.textContent = "That link might not be a direct image. If it doesn‚Äôt load, use a direct image URL.";
    } else {
      addMsg.textContent = "Adding‚Ä¶";
    }

    addDo.disabled = true;
    try{
      await addDoc(galleryCol, {
        url,
        caption,
        createdAt: serverTimestamp()
      });
      photoUrl.value = "";
      photoCaption.value = "";
      closeAddModal();
    }catch(e){
      addMsg.textContent = "Add failed: " + (e?.message || e);
    }finally{
      addDo.disabled = false;
    }
  }

  addDo.addEventListener("click", addPhoto);

  // Live gallery
  const q = query(galleryCol, orderBy("createdAt", "desc"));
  let currentUser = null;

  onSnapshot(q, (snap)=>{
    const docs = snap.docs.map(d=> ({ id:d.id, ...d.data() }));
    if(!docs.length){
      makeEmpty("No photos yet.");
      return;
    }
    galleryGrid.innerHTML = "";
    const isAdmin = !!currentUser;
    for(const item of docs){
      if(!item.url) continue;
      addImgCard(item, isAdmin);
    }
  }, (err)=>{
    if(galleryLoading) galleryLoading.textContent = "Gallery not loaded (check Firestore rules).";
  });

  // Auth state
  onAuthStateChanged(auth, (user)=>{
    currentUser = user || null;
    const signedIn = !!user;

    adminLoginOpen.style.display = signedIn ? "none" : "inline-flex";
    adminLogout.style.display = signedIn ? "inline-flex" : "none";
    addPhotoOpen.style.display = signedIn ? "inline-flex" : "none";

    authPill.classList.remove("ok","bad");
    authPill.classList.add(signedIn ? "ok" : "bad");
    authText.textContent = signedIn ? `Signed in: ${user.email || "admin"}` : "Not signed in";
    galleryHint.textContent = signedIn ? "Admin can add/delete" : "Public view";
  });

  // Remove the loading tile once JS runs
  if(galleryLoading) galleryLoading.remove();
</script>

</body>
</html>


